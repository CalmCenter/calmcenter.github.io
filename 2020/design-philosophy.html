<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>è®¾è®¡æ¨¡å¼-è®¾è®¡åŸåˆ™ç¯‡ | CalmCenter</title><meta name="description" content="SOLID åŸåˆ™å¹¶éå•çº¯çš„ 1 ä¸ªåŸåˆ™ï¼Œè€Œæ˜¯ç”± 5 ä¸ªè®¾è®¡åŸåˆ™ç»„æˆçš„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šå•ä¸€èŒè´£åŸåˆ™ã€å¼€é—­åŸåˆ™ã€é‡Œå¼æ›¿æ¢åŸåˆ™ã€æ¥å£éš”ç¦»åŸåˆ™å’Œä¾èµ–åè½¬åŸåˆ™ï¼Œä¾æ¬¡å¯¹åº” SOLID ä¸­çš„ Sã€Oã€Lã€Iã€D è¿™ 5 ä¸ªè‹±æ–‡å­—æ¯ã€‚ğŸ’™ğŸ’šğŸ’›ğŸ’œğŸ’"><meta name="keywords" content="ç¼–ç "><meta name="author" content="CalmCenter"><meta name="copyright" content="CalmCenter"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://calmcenter.club/2020/design-philosophy.html"><link rel="prev" title="è®¾è®¡æ¨¡å¼ç¯‡" href="https://calmcenter.club/2020/design-mode.html"><link rel="next" title="ç¨³å®šæ€§ä¼˜åŒ–" href="https://calmcenter.club/2020/stability-optimization.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹:${query}"}},
  translate: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"æŒ‰","message_next":"é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾"},"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-right"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: false,
  highlightShrink: 'none',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#æœ¬æ–‡ä¸»è¦è®°è½½"><span class="toc-text">æœ¬æ–‡ä¸»è¦è®°è½½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©å•ä¸€è´£ä»»åŸåˆ™"><span class="toc-text">ğŸš©å•ä¸€è´£ä»»åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å¦‚ä½•ç†è§£-â€œå•ä¸€èŒè´£åŸåˆ™â€-ï¼Ÿ"><span class="toc-text">1 å¦‚ä½•ç†è§£ â€œå•ä¸€èŒè´£åŸåˆ™â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ"><span class="toc-text">2 å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ"><span class="toc-text">3 ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©å¼€é—­åŸåˆ™"><span class="toc-text">ğŸš©å¼€é—­åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å¦‚ä½•ç†è§£-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ"><span class="toc-text">1 å¦‚ä½•ç†è§£ â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€  ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-å¦‚ä½•åšåˆ°-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ"><span class="toc-text">2 å¦‚ä½•åšåˆ° â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ"><span class="toc-text">3 å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™"><span class="toc-text">ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å¦‚ä½•ç†è§£-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ"><span class="toc-text">1 å¦‚ä½•ç†è§£ â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-å¦‚ä½•åšåˆ°-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ"><span class="toc-text">2 å¦‚ä½•åšåˆ° â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº†-LSPï¼Ÿ"><span class="toc-text">3 å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº† LSPï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©æ¥å£éš”ç¦»åŸåˆ™"><span class="toc-text">ğŸš©æ¥å£éš”ç¦»åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å¦‚ä½•ç†è§£-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ"><span class="toc-text">1 å¦‚ä½•ç†è§£ â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-å¦‚ä½•åšåˆ°-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ"><span class="toc-text">2 å¦‚ä½•åšåˆ° â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«"><span class="toc-text">3 æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©ä¾èµ–åè½¬åŸåˆ™"><span class="toc-text">ğŸš©ä¾èµ–åè½¬åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-æ§åˆ¶åè½¬"><span class="toc-text">1 æ§åˆ¶åè½¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ä¾èµ–æ³¨å…¥"><span class="toc-text">2 ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ä¾èµ–åè½¬åŸåˆ™"><span class="toc-text">3 ä¾èµ–åè½¬åŸåˆ™</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©KISS-åŸåˆ™"><span class="toc-text">ğŸš©KISS åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ"><span class="toc-text">1 ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ-KISS-åŸåˆ™å—ï¼Ÿ"><span class="toc-text">2 ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ KISS åŸåˆ™å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-å¦‚ä½•å†™å‡ºæ»¡è¶³-KISS-åŸåˆ™çš„ä»£ç ï¼Ÿ"><span class="toc-text">3 å¦‚ä½•å†™å‡ºæ»¡è¶³ KISS åŸåˆ™çš„ä»£ç ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-YAGNI-åŸåˆ™è·Ÿ-KISS-åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ"><span class="toc-text">4 YAGNI åŸåˆ™è·Ÿ KISS åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©DRY-åŸåˆ™"><span class="toc-text">ğŸš©DRY åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å®ç°é€»è¾‘é‡å¤"><span class="toc-text">1 å®ç°é€»è¾‘é‡å¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-åŠŸèƒ½è¯­ä¹‰é‡å¤"><span class="toc-text">2 åŠŸèƒ½è¯­ä¹‰é‡å¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ä»£ç æ‰§è¡Œé‡å¤"><span class="toc-text">3 ä»£ç æ‰§è¡Œé‡å¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ"><span class="toc-text">4 æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨"><span class="toc-text">5 è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ğŸš©è¿ªç±³ç‰¹æ³•åˆ™"><span class="toc-text">ğŸš©è¿ªç±³ç‰¹æ³•åˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ä½•ä¸º-â€œé«˜å†…èšã€æ¾è€¦åˆâ€-ï¼Ÿ"><span class="toc-text">1 ä½•ä¸º â€œé«˜å†…èšã€æ¾è€¦åˆâ€ ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–"><span class="toc-text">2 ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£"><span class="toc-text">3 æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ„Ÿè°¢"><span class="toc-text">æ„Ÿè°¢</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/CalmCenter/Pic/raw/master/cover38.webp)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">CalmCenter</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">è®¾è®¡æ¨¡å¼-è®¾è®¡åŸåˆ™ç¯‡</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2020-06-10 12:59:00"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2020-06-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2020-07-13 17:08:54"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2020-07-13</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%BC%96%E7%A0%81/">ç¼–ç </a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>å­—æ•°æ€»è®¡:</span><span class="word-count">15k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>é˜…è¯»æ—¶é•¿: 54 åˆ†é’Ÿ</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="æœ¬æ–‡ä¸»è¦è®°è½½"><a href="#æœ¬æ–‡ä¸»è¦è®°è½½" class="headerlink" title="æœ¬æ–‡ä¸»è¦è®°è½½"></a>æœ¬æ–‡ä¸»è¦è®°è½½</h1><ul>
<li><strong>å•ä¸€è´£ä»»åŸåˆ™</strong><ul>
<li>å¦‚ä½•ç†è§£ â€œå•ä¸€èŒè´£åŸåˆ™â€ï¼Ÿ</li>
<li>å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ</li>
<li>ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡çš„è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ</li>
</ul>
</li>
<li><strong>å¼€é—­åŸåˆ™</strong><ul>
<li>å¦‚ä½•ç†è§£ â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</li>
<li>å¦‚ä½•åšåˆ° â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ï¼Ÿ</li>
<li>å¦‚ä½•æ­£åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ</li>
</ul>
</li>
<li><strong>é‡Œå¼æ›¿æ¢åŸåˆ™</strong><ul>
<li>å¦‚ä½•ç†è§£ â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ï¼Ÿ</li>
<li>å¦‚ä½•åšåˆ° â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ï¼Ÿ</li>
<li>æ¥å£éš”ç¦»åŸåˆ™å’Œå•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«</li>
</ul>
</li>
<li><strong>ä¾èµ–åè½¬åŸåˆ™</strong><ul>
<li>æ§åˆ¶åè½¬</li>
<li>ä¾èµ–æ³¨å…¥</li>
<li>ä¾èµ–åè½¬åŸåˆ™</li>
</ul>
</li>
<li><strong>KISS åŸåˆ™</strong><ul>
<li>ä»£ç è¡Œæ•°è¶Šå°‘è¶Š â€œç®€å•â€ å—ï¼Ÿ</li>
<li>ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ KISS åŸåˆ™å—ï¼Ÿ</li>
<li>å¦‚ä½•å†™å‡ºæ»¡è¶³ KISS åŸåˆ™çš„ä»£ç ï¼Ÿ</li>
<li>YANGNI åŸåˆ™è·Ÿ KISS åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ</li>
</ul>
</li>
<li><strong>DRY åŸåˆ™</strong><ul>
<li>å®ç°é€»è¾‘é‡å¤</li>
<li>åŠŸèƒ½è¯­ä¹‰é‡å¤</li>
<li>ä»£ç æ‰§è¡Œé‡å¤</li>
<li>æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ</li>
<li>æ€è€ƒå’Œçµæ´»åº”ç”¨</li>
</ul>
</li>
<li><strong>è¿ªç±³ç‰¹æ³•åˆ™</strong><ul>
<li>ä½•ä¸º â€œé«˜å†…èšï¼Œæ¾è€¦åˆâ€ï¼Ÿ</li>
<li>ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–</li>
<li>æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£</li>
</ul>
</li>
</ul>
<hr>
<h1 id="ğŸš©å•ä¸€è´£ä»»åŸåˆ™"><a href="#ğŸš©å•ä¸€è´£ä»»åŸåˆ™" class="headerlink" title="ğŸš©å•ä¸€è´£ä»»åŸåˆ™"></a>ğŸš©å•ä¸€è´£ä»»åŸåˆ™</h1><p> (Single Responsibility Principle SRP)</p>
<h2 id="1-å¦‚ä½•ç†è§£-â€œå•ä¸€èŒè´£åŸåˆ™â€-ï¼Ÿ"><a href="#1-å¦‚ä½•ç†è§£-â€œå•ä¸€èŒè´£åŸåˆ™â€-ï¼Ÿ" class="headerlink" title="1 å¦‚ä½•ç†è§£ â€œå•ä¸€èŒè´£åŸåˆ™â€ ï¼Ÿ"></a>1 å¦‚ä½•ç†è§£ â€œå•ä¸€èŒè´£åŸåˆ™â€ ï¼Ÿ</h2><p><code>A class or module should have a single reponsibility(ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£ï¼ˆæˆ–è€…åŠŸèƒ½ï¼‰)</code></p>
<p>ä¸€ä¸ªç±»åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£æˆ–è€…åŠŸèƒ½ã€‚ä¸è¦è®¾è®¡å¤§è€Œå…¨çš„ç±»ï¼Œè¦è®¾è®¡ç²’åº¦å°ã€åŠŸèƒ½å•ä¸€çš„ç±»ã€‚å•ä¸€èŒè´£åŸåˆ™æ˜¯ä¸ºäº†å®ç°ä»£ç é«˜å†…èšã€ä½è€¦åˆï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€‚</p>
<p><strong>å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŸå› </strong>  </p>
<p><strong>æŠŠå› ä¸ºç›¸åŒçš„åŸå› è€Œæ”¹å˜çš„äº‹ç‰©èšé›†åœ¨ä¸€èµ·ã€‚æŠŠé‚£äº›å› ä¸ºä¸åŒåŸå› è€Œæ”¹å˜çš„ä¸œè¥¿åˆ†å¼€ã€‚</strong></p>
<h2 id="2-å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ"><a href="#2-å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ" class="headerlink" title="2 å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ"></a>2 å¦‚ä½•åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼Ÿ</h2><p>ä¸åŒçš„åº”ç”¨åœºæ™¯ã€ä¸åŒé˜¶æ®µçš„éœ€æ±‚èƒŒæ™¯ã€ä¸åŒçš„ä¸šåŠ¡å±‚é¢ï¼Œå¯¹åŒä¸€ä¸ªç±»çš„èŒè´£æ˜¯å¦å•ä¸€ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„åˆ¤å®šç»“æœã€‚ä¸¾ä¸ªæ —å­ğŸŒ°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> userId;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String email;</span><br><span class="line">  <span class="keyword">private</span> String telephone;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> createTime;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> lastLoginTime;</span><br><span class="line">  <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">  <span class="keyword">private</span> String provinceOfAddress; <span class="comment">// çœ</span></span><br><span class="line">  <span class="keyword">private</span> String cityOfAddress; <span class="comment">// å¸‚</span></span><br><span class="line">  <span class="keyword">private</span> String regionOfAddress; <span class="comment">// åŒº </span></span><br><span class="line">  <span class="keyword">private</span> String detailedAddress; <span class="comment">// è¯¦ç»†åœ°å€</span></span><br><span class="line">  <span class="comment">// ...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UserInfo</code> ç±»çš„è®¾è®¡æ˜¯å¦æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™å‘¢ï¼Ÿ</p>
<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§ä¸åŒçš„è§‚ç‚¹ã€‚ä¸€ç§è§‚ç‚¹æ˜¯ï¼Œ<code>UserInfo</code> ç±»åŒ…å«çš„éƒ½æ˜¯è·Ÿç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•éƒ½éš¶å±äºç”¨æˆ·è¿™æ ·ä¸€ä¸ªä¸šåŠ¡æ¨¡å‹ï¼Œæ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼›å¦ä¸€ç§è§‚ç‚¹æ˜¯ï¼Œåœ°å€ä¿¡æ¯åœ¨ <code>UserInfo</code> ç±»ä¸­ï¼Œæ‰€å çš„æ¯”é‡æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ç»§ç»­æ‹†åˆ†æˆç‹¬ç«‹çš„ <code>UserAddress</code> ç±»ï¼Œ<code>UserInfo</code> åªä¿ç•™é™¤ <code>Address</code> ä¹‹å¤–çš„å…¶ä»–ä¿¡æ¯ï¼Œæ‹†åˆ†ä¹‹åçš„ä¸¤ä¸ªç±»çš„èŒè´£æ›´åŠ å•ä¸€ã€‚</p>
<p>å“ªç§è§‚ç‚¹æ›´å¯¹å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¦ä»ä¸­åšå‡ºé€‰æ‹©ï¼Œæˆ‘ä»¬ä¸èƒ½è„±ç¦»å…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚å¦‚æœåœ¨è¿™ä¸ªç¤¾äº¤äº§å“ä¸­ï¼Œç”¨æˆ·çš„åœ°å€ä¿¡æ¯è·Ÿå…¶ä»–ä¿¡æ¯ä¸€æ ·ï¼Œåªæ˜¯å•çº¯åœ°ç”¨æ¥å±•ç¤ºï¼Œé‚£ <code>UserInfo</code> ç°åœ¨çš„è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªç¤¾äº¤äº§å“å‘å±•å¾—æ¯”è¾ƒå¥½ï¼Œä¹‹ååˆåœ¨äº§å“ä¸­æ·»åŠ äº†ç”µå•†çš„æ¨¡å—ï¼Œç”¨æˆ·çš„åœ°å€ä¿¡æ¯è¿˜ä¼šç”¨åœ¨ç”µå•†ç‰©æµä¸­ï¼Œé‚£æˆ‘ä»¬æœ€å¥½å°†åœ°å€ä¿¡æ¯ä» <code>UserInfo</code> ä¸­æ‹†åˆ†å‡ºæ¥ï¼Œç‹¬ç«‹æˆç”¨æˆ·ç‰©æµä¿¡æ¯ï¼ˆæˆ–è€…å«åœ°å€ä¿¡æ¯ã€æ”¶è´§ä¿¡æ¯ç­‰ï¼‰ã€‚</p>
<p>ä¸€äº›ä¾§é¢çš„åˆ¤æ–­æŒ‡æ ‡æ›´å…·æœ‰æŒ‡å¯¼æ„ä¹‰å’Œå¯æ‰§è¡Œæ€§ï¼Œæ¯”å¦‚ï¼Œå‡ºç°ä¸‹é¢è¿™äº›æƒ…å†µå°±æœ‰å¯èƒ½è¯´æ˜è¿™ç±»çš„è®¾è®¡ä¸æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼š</p>
<ul>
<li>ç±»ä¸­çš„ä»£ç è¡Œæ•°ã€å‡½æ•°æˆ–è€…å±æ€§è¿‡å¤šï¼›</li>
<li>ç±»ä¾èµ–çš„å…¶ä»–ç±»è¿‡å¤šï¼Œæˆ–è€…ä¾èµ–ç±»çš„å…¶ä»–ç±»è¿‡å¤šï¼›</li>
<li>ç§æœ‰æ–¹æ³•è¿‡å¤šï¼›</li>
<li>æ¯”è¾ƒéš¾ç»™ç±»èµ·ä¸€ä¸ªåˆé€‚çš„åå­—ï¼›</li>
<li>ç±»ä¸­å¤§é‡çš„æ–¹æ³•éƒ½æ˜¯é›†ä¸­æ“ä½œç±»ä¸­çš„æŸå‡ ä¸ªå±æ€§ï¼›</li>
</ul>
<p>è‡³äºå¦‚ä½•åˆ¤æ–­ <em>è¿‡å¤š</em> ï¼Œå®é™…ä¸Šï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸å¥½å®šé‡åœ°å›ç­”ï¼Œå°±åƒä½ é—®å¤§å¨ â€œæ”¾ç›å°‘è®¸â€ ä¸­çš„ â€œå°‘è®¸â€ æ˜¯å¤šå°‘ï¼Œå¤§å¨ä¹Ÿå¾ˆéš¾å‘Šè¯‰ä½ ä¸€ä¸ªç‰¹åˆ«å…·ä½“çš„é‡å€¼ï¼Œéƒ½æ˜¯ç»éªŒä¸æ„Ÿè§‰ã€‚</p>
<p>ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œå½“ä¸€ä¸ªç±»çš„ä»£ç ï¼Œè¯»èµ·æ¥è®©ä½ å¤´å¤§äº†ï¼Œå®ç°æŸä¸ªåŠŸèƒ½æ—¶ä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªå‡½æ•°äº†ï¼Œæƒ³ç”¨å“ªä¸ªå‡½æ•°ç¿»åŠå¤©éƒ½æ‰¾ä¸åˆ°äº†ï¼Œåªç”¨åˆ°ä¸€ä¸ªå°åŠŸèƒ½è¦å¼•å…¥æ•´ä¸ªç±»ï¼ˆç±»ä¸­åŒ…å«å¾ˆå¤šæ— å…³æ­¤åŠŸèƒ½å®ç°çš„å‡½æ•°ï¼‰çš„æ—¶å€™ï¼Œè¿™å°±è¯´æ˜ç±»çš„è¡Œæ•°ã€å‡½æ•°ã€å±æ€§è¿‡å¤šäº†ã€‚é¡¹ç›®åšå¤šäº†ï¼Œä»£ç å†™å¤šäº†ï¼Œåœ¨å¼€å‘ä¸­æ…¢æ…¢ â€œå“å°â€ ï¼Œè‡ªç„¶å°±çŸ¥é“ä»€ä¹ˆæ˜¯ â€œæ”¾ç›å°‘è®¸â€ äº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œä¸“ä¸šç¬¬å…­æ„Ÿâ€ ã€‚</p>
<h2 id="3-ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ"><a href="#3-ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ" class="headerlink" title="3 ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ"></a>3 ç±»çš„èŒè´£æ˜¯å¦è®¾è®¡å¾—è¶Šå•ä¸€è¶Šå¥½ï¼Ÿ</h2><p>ä¸ºäº†æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼Œæ˜¯ä¸æ˜¯æŠŠç±»æ‹†å¾—è¶Šç»†å°±è¶Šå¥½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p>
<p>å•ä¸€èŒè´£åŸåˆ™é€šè¿‡é¿å…è®¾è®¡å¤§è€Œå…¨çš„ç±»ï¼Œé¿å…å°†ä¸ç›¸å…³çš„åŠŸèƒ½è€¦åˆåœ¨ä¸€èµ·ï¼Œæ¥æé«˜ç±»çš„å†…èšæ€§ã€‚<br>åŒæ—¶ï¼Œç±»èŒè´£å•ä¸€ï¼Œç±»ä¾èµ–çš„å’Œè¢«ä¾èµ–çš„å…¶ä»–ç±»ä¹Ÿä¼šå˜å°‘ï¼Œå‡å°‘äº†ä»£ç çš„è€¦åˆæ€§ï¼Œä»¥æ­¤æ¥å®ç°ä»£ç çš„é«˜å†…èšã€ä½è€¦åˆã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœæ‹†åˆ†å¾—è¿‡ç»†ï¼Œå®é™…ä¸Šä¼šé€‚å¾—å…¶åï¼Œåå€’ä¼šé™ä½å†…èšæ€§ï¼Œä¹Ÿä¼šå½±å“ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° <code>Serialization</code> ç±»å®ç°äº†ä¸€ä¸ª ç®€å•åè®® çš„ åºåˆ—åŒ– å’Œ ååºåˆ— åŠŸèƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialization</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">serialize</span><span class="params">(Map&lt;String, String&gt; object)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">deserialize</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æƒ³è®©ç±»çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œæˆ‘ä»¬å¯¹ <code>Serialization</code> ç±»è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œæ‹†åˆ†æˆä¸€ä¸ªåªè´Ÿè´£åºåˆ—åŒ–å·¥ä½œçš„ <code>Serializer</code> ç±»å’Œå¦ä¸€ä¸ªåªè´Ÿè´£ååºåˆ—åŒ–å·¥ä½œçš„ <code>Deserializer</code> ç±»ã€‚ä½†æ˜¯ï¼Œç°åœ¨å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†åè®®çš„æ ¼å¼ï¼Œæˆ–è€…åºåˆ—åŒ–æ–¹å¼ä» <code>JSON</code> æ”¹ä¸ºäº† <code>XML</code> ï¼Œé‚£ <code>Serializer</code> ç±»å’Œ <code>Deserializer</code> ç±»éƒ½éœ€è¦åšç›¸åº”çš„ä¿®æ”¹ï¼Œä»£ç çš„å†…èšæ€§æ˜¾ç„¶æ²¡æœ‰åŸæ¥ <code>Serialization</code> é«˜äº†ã€‚æ‹†åˆ†ä¹‹åï¼Œä»£ç çš„å¯ç»´æŠ¤æ€§å˜å·®äº†ã€‚</p>
<hr>
<h1 id="ğŸš©å¼€é—­åŸåˆ™"><a href="#ğŸš©å¼€é—­åŸåˆ™" class="headerlink" title="ğŸš©å¼€é—­åŸåˆ™"></a>ğŸš©å¼€é—­åŸåˆ™</h1><p>å¼€é—­åŸåˆ™ <code>(Open-Closed Principle ç®€ç§° OCP)</code> æ˜¯ <code>SOLID</code> ä¸­æœ€éš¾ç†è§£ã€æœ€éš¾æŒæ¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„ä¸€æ¡åŸåˆ™ã€‚</p>
<h2 id="1-å¦‚ä½•ç†è§£-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ"><a href="#1-å¦‚ä½•ç†è§£-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ" class="headerlink" title="1 å¦‚ä½•ç†è§£ â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€  ï¼Ÿ"></a>1 å¦‚ä½•ç†è§£ â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€  ï¼Ÿ</h2><p><code>software entities (modules, classes, functions, etc.) should be open for extension , but closed for modification(è½¯ä»¶å®ä½“ï¼ˆæ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰åº”è¯¥â€œå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­â€ã€‚)</code></p>
<p>æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œåº”è¯¥æ˜¯é€šè¿‡åœ¨å·²æœ‰ä»£ç åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰çš„æ–¹å¼æ¥å®Œæˆã€‚</p>
<ul>
<li>å¼€é—­åŸåˆ™å¹¶ä¸æ˜¯è¯´å®Œå…¨æœç»ä¿®æ”¹ï¼Œè€Œæ˜¯ä»¥æœ€å°çš„ä¿®æ”¹ä»£ç çš„ä»£ä»·æ¥å®Œæˆæ–°åŠŸèƒ½çš„å¼€å‘ã€‚</li>
<li>åŒæ ·çš„ä»£ç æ”¹åŠ¨ï¼Œåœ¨ç²—ä»£ç ç²’åº¦ä¸‹ï¼Œå¯èƒ½è¢«è®¤å®šä¸ºâ€œä¿®æ”¹â€ï¼›åœ¨ç»†ä»£ç ç²’åº¦ä¸‹ï¼Œå¯èƒ½åˆè¢«è®¤å®šä¸ºâ€œæ‰©å±•â€ã€‚</li>
</ul>
<h2 id="2-å¦‚ä½•åšåˆ°-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ"><a href="#2-å¦‚ä½•åšåˆ°-â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€-ï¼Ÿ" class="headerlink" title="2 å¦‚ä½•åšåˆ° â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ ï¼Ÿ"></a>2 å¦‚ä½•åšåˆ° â€œå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­â€ ï¼Ÿ</h2><p>ä¸¾ä¸ªæ —å­ğŸŒ° ä¸€ä¸ªè­¦å‘Šé€šçŸ¥ç³»ç»Ÿï¼Œé€šè¿‡å„ç§åˆ¤æ–­æ˜¯å¦éœ€è¦é€šçŸ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Alert</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> AlertRule rule;</span><br><span class="line">  <span class="keyword">private</span> Notification notification;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Alert</span><span class="params">(AlertRule rule, Notification notification)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.rule = rule;</span><br><span class="line">    <span class="keyword">this</span>.notification = notification;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String api, <span class="keyword">long</span> requestCount, <span class="keyword">long</span> errorCount, <span class="keyword">long</span> durationOfSeconds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> tps = requestCount / durationOfSeconds;</span><br><span class="line">    <span class="keyword">if</span> (tps &gt; rule.getMatchedRule(api).getMaxTps()) &#123;<span class="comment">//TPS æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">      notification.notify(NotificationEmergencyLevel.URGENCY, <span class="string">"..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) &#123;<span class="comment">//é”™è¯¯æ•° æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">      notification.notify(NotificationEmergencyLevel.SEVERE, <span class="string">"..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸šåŠ¡é€»è¾‘ä¸»è¦é›†ä¸­åœ¨ <code>check()</code> å‡½æ•°ä¸­ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªè­¦å‘ŠåŠŸèƒ½ï¼Œå½“æ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°ï¼Œè¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§é˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè¦è§¦å‘å‘Šè­¦å‘é€é€šçŸ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æ”¹åŠ¨ä»£ç å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Alert</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...çœç•¥AlertRule/Notificationå±æ€§å’Œæ„é€ å‡½æ•°...</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ”¹åŠ¨ä¸€ï¼šæ·»åŠ å‚æ•°timeoutCount</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String api, <span class="keyword">long</span> requestCount, <span class="keyword">long</span> errorCount, <span class="keyword">long</span> timeoutCount, <span class="keyword">long</span> durationOfSeconds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> tps = requestCount / durationOfSeconds;</span><br><span class="line">    <span class="keyword">if</span> (tps &gt; rule.getMatchedRule(api).getMaxTps()) &#123;...&#125;<span class="comment">//TPS æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (errorCount &gt; rule.getMatchedRule(api).getMaxErrorCount()) &#123;...&#125;<span class="comment">//é”™è¯¯æ•° æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="comment">// æ”¹åŠ¨äºŒï¼šæ·»åŠ æ¥å£è¶…æ—¶å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">long</span> timeoutTps = timeoutCount / durationOfSeconds;</span><br><span class="line">    <span class="keyword">if</span> (timeoutTps &gt; rule.getMatchedRule(api).getMaxTimeoutTps()) &#123;</span><br><span class="line">      notification.notify(NotificationEmergencyLevel.URGENCY, <span class="string">"..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„ä»£ç ä¿®æ”¹å®é™…ä¸Šå­˜åœ¨æŒºå¤šé—®é¢˜çš„ã€‚</p>
<ul>
<li>ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯¹æ¥å£è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™å°±æ„å‘³ç€è°ƒç”¨è¿™ä¸ªæ¥å£çš„ä»£ç éƒ½è¦åšç›¸åº”çš„ä¿®æ”¹ã€‚</li>
<li>å¦ä¸€æ–¹é¢ï¼Œä¿®æ”¹äº† <code>check()</code> å‡½æ•°ï¼Œç›¸åº”çš„å•å…ƒæµ‹è¯•éƒ½éœ€è¦ä¿®æ”¹</li>
</ul>
<p>è¿™ä¸ªä»£ç æ”¹åŠ¨æ˜¯åŸºäº â€œä¿®æ”¹â€ çš„æ–¹å¼æ¥å®ç°æ–°åŠŸèƒ½çš„ã€‚å¦‚æœæˆ‘ä»¬éµå¾ªå¼€é—­åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯ â€œå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­â€ ã€‚é‚£å¦‚ä½•é€šè¿‡ â€œæ‰©å±•â€ çš„æ–¹å¼ï¼Œæ¥å®ç°åŒæ ·çš„åŠŸèƒ½å‘¢ï¼Ÿ</p>
<p>å…ˆé‡æ„ä¸€ä¸‹ä¹‹å‰çš„ <code>Alert</code> ä»£ç ï¼Œè®©å®ƒçš„æ‰©å±•æ€§æ›´å¥½ä¸€äº›ã€‚é‡æ„çš„å†…å®¹ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯å°† <code>check()</code> å‡½æ•°çš„å¤šä¸ªå…¥å‚å°è£…æˆ <code>ApiStatInfo</code> ç±»ï¼›</li>
<li>ç¬¬äºŒéƒ¨åˆ†æ˜¯å¼•å…¥ <code>handler</code> çš„æ¦‚å¿µï¼Œå°† if åˆ¤æ–­é€»è¾‘åˆ†æ•£åœ¨å„ä¸ª <code>handler</code> ä¸­ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Alert</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;AlertHandler&gt; alertHandlers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAlertHandler</span><span class="params">(AlertHandler alertHandler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.alertHandlers.add(alertHandler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(ApiStatInfo apiStatInfo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (AlertHandler handler : alertHandlers) &#123;</span><br><span class="line">      handler.check(apiStatInfo);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiStatInfo</span> </span>&#123;<span class="comment">//çœç•¥constructor/getter/setteræ–¹æ³•</span></span><br><span class="line">  <span class="keyword">private</span> String api;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> requestCount;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> errorCount;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> durationOfSeconds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> AlertRule rule;</span><br><span class="line">  <span class="keyword">protected</span> Notification notification;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AlertHandler</span><span class="params">(AlertRule rule, Notification notification)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.rule = rule;</span><br><span class="line">    <span class="keyword">this</span>.notification = notification;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(ApiStatInfo apiStatInfo)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TpsAlertHandler</span> <span class="keyword">extends</span> <span class="title">AlertHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TpsAlertHandler</span><span class="params">(AlertRule rule, Notification notification)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(rule, notification);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(ApiStatInfo apiStatInfo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> tps = apiStatInfo.getRequestCount()/ apiStatInfo.getDurationOfSeconds();</span><br><span class="line">    <span class="keyword">if</span> (tps &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxTps()) &#123;<span class="comment">//TPS æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">      notification.notify(NotificationEmergencyLevel.URGENCY, <span class="string">"..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorAlertHandler</span> <span class="keyword">extends</span> <span class="title">AlertHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ErrorAlertHandler</span><span class="params">(AlertRule rule, Notification notification)</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(rule, notification);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(ApiStatInfo apiStatInfo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (apiStatInfo.getErrorCount() &gt; rule.getMatchedRule(apiStatInfo.getApi()).getMaxErrorCount()) &#123;<span class="comment">//é”™è¯¯æ•° æ˜¯å¦è¶…è¿‡æŸä¸ªé¢„å…ˆè®¾ç½®çš„æœ€å¤§å€¼</span></span><br><span class="line">      notification.notify(NotificationEmergencyLevel.SEVERE, <span class="string">"..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å†™ä¸€ä¸ªå•ä¾‹æä¾›é…ç½®å’Œä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContext</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> AlertRule alertRule;</span><br><span class="line">  <span class="keyword">private</span> Notification notification;</span><br><span class="line">  <span class="keyword">private</span> Alert alert;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initializeBeans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    alertRule = <span class="keyword">new</span> AlertRule(<span class="comment">/*.çœç•¥å‚æ•°.*/</span>); <span class="comment">//çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç </span></span><br><span class="line">    notification = <span class="keyword">new</span> Notification(<span class="comment">/*.çœç•¥å‚æ•°.*/</span>); <span class="comment">//çœç•¥ä¸€äº›åˆå§‹åŒ–ä»£ç </span></span><br><span class="line">    alert = <span class="keyword">new</span> Alert();<span class="comment">//æ·»åŠ è­¦å‘Šæ–¹å¼</span></span><br><span class="line">    alert.addAlertHandler(<span class="keyword">new</span> TpsAlertHandler(alertRule, notification));</span><br><span class="line">    alert.addAlertHandler(<span class="keyword">new</span> ErrorAlertHandler(alertRule, notification));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Alert <span class="title">getAlert</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> alert; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¥¿æ±‰å¼å•ä¾‹</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ApplicationContext instance = <span class="keyword">new</span> ApplicationContext();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">ApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    instance.initializeBeans();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ApiStatInfo apiStatInfo = <span class="keyword">new</span> ApiStatInfo();</span><br><span class="line">    <span class="comment">// apiStatInfo.setxxx() ...çœç•¥è®¾ç½®apiStatInfoæ•°æ®å€¼çš„ä»£ç </span></span><br><span class="line">    ApplicationContext.getInstance().getAlert().check(apiStatInfo);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå†æ·»åŠ ä¸Šé¢çš„é‚£ä¸ªæ–°åŠŸèƒ½ï¼Œæ¯ç§’é’Ÿæ¥å£è¶…æ—¶è¯·æ±‚ä¸ªæ•°è¶…è¿‡æŸä¸ªæœ€å¤§é˜ˆå€¼å°±å‘Šè­¦ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•æ”¹åŠ¨ä»£ç å‘¢ï¼Ÿ</p>
<ul>
<li>ç¬¬ä¸€å¤„æ”¹åŠ¨æ˜¯ï¼šåœ¨ <code>ApiStatInfo</code> ç±»ä¸­æ·»åŠ æ–°çš„å±æ€§ <code>timeoutCount</code>ã€‚</li>
<li>ç¬¬äºŒå¤„æ”¹åŠ¨æ˜¯ï¼šæ·»åŠ æ–°çš„ <code>TimeoutAlertHander</code> ç±»ã€‚</li>
<li>ç¬¬ä¸‰å¤„æ”¹åŠ¨æ˜¯ï¼šåœ¨ <code>ApplicationContext</code> ç±»çš„ <code>initializeBeans()</code> æ–¹æ³•ä¸­ï¼Œå¾€ alert å¯¹è±¡ä¸­æ³¨å†Œæ–°çš„ <code>timeoutAlertHandler</code>ã€‚</li>
<li>ç¬¬å››å¤„æ”¹åŠ¨æ˜¯ï¼šåœ¨ä½¿ç”¨ <code>Alert</code> ç±»çš„æ—¶å€™ï¼Œéœ€è¦ç»™ <code>check()</code> å‡½æ•°çš„å…¥å‚ <code>apiStatInfo</code> å¯¹è±¡è®¾ç½® <code>timeoutCount</code> çš„å€¼ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Alert</span> </span>&#123; <span class="comment">// ä»£ç æœªæ”¹åŠ¨... &#125;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiStatInfo</span> </span>&#123;<span class="comment">//çœç•¥constructor/getter/setteræ–¹æ³•</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> timeoutCount; <span class="comment">// æ”¹åŠ¨ä¸€ï¼šæ·»åŠ æ–°å­—æ®µ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertHandler</span> </span>&#123; <span class="comment">//ä»£ç æœªæ”¹åŠ¨... &#125;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TpsAlertHandler</span> <span class="keyword">extends</span> <span class="title">AlertHandler</span> </span>&#123;<span class="comment">//ä»£ç æœªæ”¹åŠ¨...&#125;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorAlertHandler</span> <span class="keyword">extends</span> <span class="title">AlertHandler</span> </span>&#123;<span class="comment">//ä»£ç æœªæ”¹åŠ¨...&#125;</span></span><br><span class="line"><span class="comment">// æ”¹åŠ¨äºŒï¼šæ·»åŠ æ–°çš„handler</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeoutAlertHandler</span> <span class="keyword">extends</span> <span class="title">AlertHandler</span> </span>&#123;<span class="comment">//çœç•¥ä»£ç ...&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContext</span> </span>&#123;</span><br><span class="line">	  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initializeBeans</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    alert = <span class="keyword">new</span> Alert();</span><br><span class="line">    alert.addAlertHandler(<span class="keyword">new</span> TpsAlertHandler(alertRule, notification));</span><br><span class="line">    alert.addAlertHandler(<span class="keyword">new</span> ErrorAlertHandler(alertRule, notification));</span><br><span class="line">    <span class="comment">// æ”¹åŠ¨ä¸‰ï¼šæ³¨å†Œhandler</span></span><br><span class="line">    alert.addAlertHandler(<span class="keyword">new</span> TimeoutAlertHandler(alertRule, notification));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–æœªæ”¹åŠ¨ä»£ç ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ApiStatInfo apiStatInfo = <span class="keyword">new</span> ApiStatInfo();</span><br><span class="line">    <span class="comment">// ...çœç•¥apiStatInfoçš„setå­—æ®µä»£ç </span></span><br><span class="line">    apiStatInfo.setTimeoutCount(<span class="number">289</span>); <span class="comment">// æ”¹åŠ¨å››ï¼šè®¾ç½®tiemoutCountå€¼</span></span><br><span class="line">    ApplicationContext.getInstance().getAlert().check(apiStatInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡æ„ä¹‹åçš„ä»£ç æ›´åŠ çµæ´»å’Œæ˜“æ‰©å±•ã€‚å¦‚æœæˆ‘ä»¬è¦æƒ³æ·»åŠ æ–°çš„å‘Šè­¦é€»è¾‘ï¼Œåªéœ€è¦åŸºäºæ‰©å±•çš„æ–¹å¼åˆ›å»ºæ–°çš„ <code>handler</code> ç±»å³å¯ï¼Œä¸éœ€è¦æ”¹åŠ¨åŸæ¥çš„ <code>check()</code> å‡½æ•°çš„é€»è¾‘ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºæ–°çš„ handler ç±»æ·»åŠ å•å…ƒæµ‹è¯•ï¼Œè€çš„å•å…ƒæµ‹è¯•éƒ½ä¸ä¼šå¤±è´¥ï¼Œä¹Ÿä¸ç”¨ä¿®æ”¹ã€‚</p>
<h2 id="3-å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ"><a href="#3-å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ" class="headerlink" title="3 å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ"></a>3 å¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»åº”ç”¨å¼€é—­åŸåˆ™ï¼Ÿ</h2><p>å†™å‡ºæ”¯æŒ â€œå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­â€ çš„ä»£ç çš„å…³é”®æ˜¯é¢„ç•™ <strong>æ‰©å±•ç‚¹</strong> ã€‚é‚£é—®é¢˜æ˜¯å¦‚ä½•æ‰èƒ½è¯†åˆ«å‡ºæ‰€æœ‰å¯èƒ½çš„æ‰©å±•ç‚¹å‘¢ï¼Ÿ</p>
<p>è¦æƒ³è¯†åˆ«å‡ºå°½å¯èƒ½å¤šçš„æ‰©å±•ç‚¹ï¼Œå°±è¦å¯¹ä¸šåŠ¡æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œèƒ½å¤ŸçŸ¥é“å½“ä¸‹ä»¥åŠæœªæ¥å¯èƒ½è¦æ”¯æŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚ä¸è¿‡ï¼Œæœ‰ä¸€å¥è¯è¯´å¾—å¥½ï¼Œâ€œå”¯ä¸€ä¸å˜çš„åªæœ‰å˜åŒ–æœ¬èº«â€ã€‚å³ä¾¿æˆ‘ä»¬å¯¹ä¸šåŠ¡ã€å¯¹ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œé‚£ä¹Ÿä¸å¯èƒ½è¯†åˆ«å‡ºæ‰€æœ‰çš„æ‰©å±•ç‚¹ï¼Œå³ä¾¿ä½ èƒ½è¯†åˆ«å‡ºæ‰€æœ‰çš„æ‰©å±•ç‚¹ï¼Œä¸ºè¿™äº›åœ°æ–¹éƒ½é¢„ç•™æ‰©å±•ç‚¹ï¼Œè¿™æ ·åšçš„æˆæœ¬ä¹Ÿæ˜¯ä¸å¯æ¥å—çš„ã€‚æˆ‘ä»¬æ²¡å¿…è¦ä¸ºä¸€äº›é¥è¿œçš„ã€ä¸ä¸€å®šå‘ç”Ÿçš„éœ€æ±‚å»æå‰ä¹°å•ï¼Œåšè¿‡åº¦è®¾è®¡ã€‚</p>
<p>è€Œä¸”ï¼Œå¼€é—­åŸåˆ™ä¹Ÿå¹¶ä¸æ˜¯å…è´¹çš„ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œä»£ç çš„æ‰©å±•æ€§ä¼šè·Ÿå¯è¯»æ€§ç›¸å†²çªã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸¾çš„ <code>Alert</code> æŠ¥è­¦çš„ä¾‹å­ã€‚ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œäº†é‡æ„ï¼Œé‡æ„ä¹‹åçš„ä»£ç è¦æ¯”ä¹‹å‰çš„ä»£ç å¤æ‚å¾ˆå¤šï¼Œç†è§£èµ·æ¥ä¹Ÿæ›´åŠ æœ‰éš¾åº¦ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿™é‡Œæ²¡æœ‰ä¸€ä¸ªæ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„å‚è€ƒæ ‡å‡†ï¼Œå…¨å‡­å®é™…çš„åº”ç”¨åœºæ™¯æ¥å†³å®šã€‚</p>
<hr>
<h1 id="ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™"><a href="#ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™" class="headerlink" title="ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™"></a>ğŸš©é‡Œæ°æ›¿æ¢åŸåˆ™</h1><p><code>(Liskov Substitution Principle ç®€ç§° LSP)</code></p>
<h2 id="1-å¦‚ä½•ç†è§£-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ"><a href="#1-å¦‚ä½•ç†è§£-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ" class="headerlink" title="1 å¦‚ä½•ç†è§£ â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ"></a>1 å¦‚ä½•ç†è§£ â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ</h2><p><code>If S is a subtype of T, then objects of type T may be replaced with objects of type S, without breaking the programã€‚</code></p>
<p><code>Functions that use pointers of references to base classes must be able to use objects of derived classes without knowing itã€‚</code></p>
<p><code>(å­ç±»å¯¹è±¡èƒ½å¤Ÿæ›¿æ¢ç¨‹åºä¸­çˆ¶ç±»å¯¹è±¡å‡ºç°çš„ä»»ä½•åœ°æ–¹ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚)</code></p>
<p>é‡Œå¼æ›¿æ¢åŸåˆ™æ›´åƒæ˜¯ä¸€ä¸ªå¤šæ€çš„è§„èŒƒã€‚é‡Œå¼æ›¿æ¢åŸåˆ™æ˜¯ç”¨å¤šæ€å®ç°çš„ï¼Œå¤šæ€å®ç°çš„å­ç±»ä¸ä¸€å®šç¬¦åˆé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
<h2 id="2-å¦‚ä½•åšåˆ°-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ"><a href="#2-å¦‚ä½•åšåˆ°-â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€-ï¼Ÿ" class="headerlink" title="2 å¦‚ä½•åšåˆ° â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ"></a>2 å¦‚ä½•åšåˆ° â€œé‡Œå¼æ›¿æ¢åŸåˆ™â€ ï¼Ÿ</h2><p>ä¸¾ä¸ªæ —å­ğŸŒ° å­ç±» <code>SecurityTransporter</code> ç»§æ‰¿çˆ¶ç±» <code>Transporter</code>ï¼Œå¢åŠ äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæ”¯æŒä¼ è¾“ <code>appId</code> å’Œ <code>appToken</code> å®‰å…¨è®¤è¯ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transporter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> HttpClient httpClient;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Transporter</span><span class="params">(HttpClient httpClient)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.httpClient = httpClient;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Response <span class="title">sendRequest</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...use httpClient to send request</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityTransporter</span> <span class="keyword">extends</span> <span class="title">Transporter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String appId;</span><br><span class="line">  <span class="keyword">private</span> String appToken;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SecurityTransporter</span><span class="params">(HttpClient httpClient, String appId, String appToken)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(httpClient);</span><br><span class="line">    <span class="keyword">this</span>.appId = appId;</span><br><span class="line">    <span class="keyword">this</span>.appToken = appToken;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Response <span class="title">sendRequest</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotBlank(appId) &amp;&amp; StringUtils.isNotBlank(appToken)) &#123;</span><br><span class="line">      request.addPayload(<span class="string">"app-id"</span>, appId);</span><br><span class="line">      request.addPayload(<span class="string">"app-token"</span>, appToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.sendRequest(request);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;    </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoFunction</span><span class="params">(Transporter transporter)</span> </span>&#123;    </span><br><span class="line">    Reuqest request = <span class="keyword">new</span> Request();</span><br><span class="line">    <span class="comment">//...çœç•¥è®¾ç½®requestä¸­æ•°æ®å€¼çš„ä»£ç ...</span></span><br><span class="line">    Response response = transporter.sendRequest(request);</span><br><span class="line">    <span class="comment">//...çœç•¥å…¶ä»–é€»è¾‘...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡Œå¼æ›¿æ¢åŸåˆ™</span></span><br><span class="line">Demo demo = <span class="keyword">new</span> Demo();</span><br><span class="line">demo.demofunction(<span class="keyword">new</span> SecurityTransporter(<span class="comment">/*çœç•¥å‚æ•°*/</span>););</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå­ç±» SecurityTransporter çš„è®¾è®¡å®Œå…¨ç¬¦åˆé‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥æ›¿æ¢çˆ¶ç±»å‡ºç°çš„ä»»ä½•ä½ç½®ï¼Œå¹¶ä¸”åŸæ¥ä»£ç çš„é€»è¾‘è¡Œä¸ºä¸å˜ä¸”æ­£ç¡®æ€§ä¹Ÿæ²¡æœ‰è¢«ç ´åã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯¹ <code>SecurityTransporter</code> ç±»ä¸­ <code>sendRequest()</code> å‡½æ•°ç¨åŠ æ”¹é€ ä¸€ä¸‹ã€‚æ”¹é€ å‰ï¼Œå¦‚æœ <code>appId</code> æˆ–è€… <code>appToken</code> æ²¡æœ‰è®¾ç½®ï¼Œæˆ‘ä»¬å°±ä¸åšæ ¡éªŒï¼›æ”¹é€ åï¼Œå¦‚æœ <code>appId</code> æˆ–è€… <code>appToken</code> æ²¡æœ‰è®¾ç½®ï¼Œåˆ™ç›´æ¥æŠ›å‡º <code>NoAuthorizationRuntimeException</code> æœªæˆæƒå¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¹é€ åï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityTransporter</span> <span class="keyword">extends</span> <span class="title">Transporter</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ..</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Response <span class="title">sendRequest</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(appId) || StringUtils.isBlank(appToken)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoAuthorizationRuntimeException(...);</span><br><span class="line">    &#125;</span><br><span class="line">    request.addPayload(<span class="string">"app-id"</span>, appId);</span><br><span class="line">    request.addPayload(<span class="string">"app-token"</span>, appToken);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.sendRequest(request);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ”¹é€ ä¹‹åçš„ä»£ç ä¸­ï¼Œå¦‚æœä¼ é€’è¿› <code>demoFunction()</code> å‡½æ•°çš„æ˜¯çˆ¶ç±» <code>Transporter</code> å¯¹è±¡ï¼Œé‚£ <code>demoFunction()</code> å‡½æ•°å¹¶ä¸ä¼šæœ‰å¼‚å¸¸æŠ›å‡ºã€‚<br>ä½†å¦‚æœä¼ é€’ç»™ <code>demoFunction()</code> å‡½æ•°çš„æ˜¯å­ç±» <code>SecurityTransporter</code> å¯¹è±¡ï¼Œé‚£ <code>demoFunction()</code> æœ‰å¯èƒ½ä¼šæœ‰å¼‚å¸¸æŠ›å‡ºã€‚<br>å­ç±»æ›¿æ¢çˆ¶ç±»ä¼ é€’è¿› <code>demoFunction</code> å‡½æ•°ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„é€»è¾‘è¡Œä¸ºæœ‰äº†æ”¹å˜ã€‚è¿™æ ·å°±è¿èƒŒäº†é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯ç”±å¤šæ€å®ç°çš„ã€‚</p>
<p>å¤šæ€ å’Œ é‡Œå¼æ›¿æ¢ æœ‰ç‚¹ç±»ä¼¼ï¼Œä½†å®ƒä»¬å…³æ³¨çš„è§’åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚<br>å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€å¤§ç‰¹æ€§ï¼Œä¹Ÿæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§è¯­æ³•ã€‚å®ƒæ˜¯ä¸€ç§ä»£ç å®ç°çš„æ€è·¯ã€‚<br>è€Œé‡Œå¼æ›¿æ¢æ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œæ˜¯ç”¨æ¥æŒ‡å¯¼ç»§æ‰¿å…³ç³»ä¸­å­ç±»è¯¥å¦‚ä½•è®¾è®¡çš„ï¼Œå­ç±»çš„è®¾è®¡è¦ä¿è¯åœ¨æ›¿æ¢çˆ¶ç±»çš„æ—¶å€™ï¼Œä¸æ”¹å˜åŸæœ‰ç¨‹åºçš„é€»è¾‘ä»¥åŠä¸ç ´ååŸæœ‰ç¨‹åºçš„æ­£ç¡®æ€§ã€‚</p>
<h2 id="3-å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº†-LSPï¼Ÿ"><a href="#3-å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº†-LSPï¼Ÿ" class="headerlink" title="3 å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº† LSPï¼Ÿ"></a>3 å“ªäº›ä»£ç æ˜æ˜¾è¿èƒŒäº† LSPï¼Ÿ</h2><ul>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»å£°æ˜è¦å®ç°çš„åŠŸèƒ½</p>
<p>çˆ¶ç±»ä¸­æä¾›çš„ <code>sortOrdersByAmount()</code> è®¢å•æ’åºå‡½æ•°ï¼Œæ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ¥ç»™è®¢å•æ’åºçš„ï¼Œè€Œå­ç±»é‡å†™è¿™ä¸ª <code>sortOrdersByAmount()</code> è®¢å•æ’åºå‡½æ•°ä¹‹åï¼Œæ˜¯æŒ‰ç…§åˆ›å»ºæ—¥æœŸæ¥ç»™è®¢å•æ’åºçš„ã€‚é‚£å­ç±»çš„è®¾è®¡å°±è¿èƒŒé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®š</p>
<p>åœ¨çˆ¶ç±»ä¸­ï¼ŒæŸä¸ªå‡½æ•°çº¦å®šï¼šè¿è¡Œå‡ºé”™çš„æ—¶å€™è¿”å› <code>null</code>ï¼›è·å–æ•°æ®ä¸ºç©ºçš„æ—¶å€™è¿”å›ç©ºé›†åˆ <code>ï¼ˆempty collectionï¼‰</code> ã€‚è€Œå­ç±»é‡è½½å‡½æ•°ä¹‹åï¼Œå®ç°å˜äº†ï¼Œè¿è¡Œå‡ºé”™è¿”å›å¼‚å¸¸ <code>ï¼ˆexceptionï¼‰</code> ï¼Œè·å–ä¸åˆ°æ•°æ®è¿”å› <code>null</code> ã€‚é‚£å­ç±»çš„è®¾è®¡å°±è¿èƒŒé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
<p>åœ¨çˆ¶ç±»ä¸­ï¼ŒæŸä¸ªå‡½æ•°çº¦å®šï¼Œè¾“å…¥æ•°æ®å¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œä½†å­ç±»å®ç°çš„æ—¶å€™ï¼Œåªå…è®¸è¾“å…¥æ•°æ®æ˜¯æ­£æ•´æ•°ï¼Œè´Ÿæ•°å°±æŠ›å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»å¯¹è¾“å…¥çš„æ•°æ®çš„æ ¡éªŒæ¯”çˆ¶ç±»æ›´åŠ ä¸¥æ ¼ï¼Œé‚£å­ç±»çš„è®¾è®¡å°±è¿èƒŒäº†é‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
<p>åœ¨çˆ¶ç±»ä¸­ï¼ŒæŸä¸ªå‡½æ•°çº¦å®šï¼Œåªä¼šæŠ›å‡º <code>ArgumentNullException</code> å¼‚å¸¸ï¼Œé‚£å­ç±»çš„è®¾è®¡å®ç°ä¸­åªå…è®¸æŠ›å‡º <code>ArgumentNullException</code> å¼‚å¸¸ï¼Œä»»ä½•å…¶ä»–å¼‚å¸¸çš„æŠ›å‡ºï¼Œéƒ½ä¼šå¯¼è‡´å­ç±»è¿èƒŒé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»æ³¨é‡Šä¸­æ‰€ç½—åˆ—çš„ä»»ä½•ç‰¹æ®Šè¯´æ˜</p>
<p>çˆ¶ç±»ä¸­å®šä¹‰çš„ <code>withdraw()</code> æç°å‡½æ•°çš„æ³¨é‡Šæ˜¯è¿™ä¹ˆå†™çš„ï¼šâ€œç”¨æˆ·çš„æç°é‡‘é¢ä¸å¾—è¶…è¿‡è´¦æˆ·ä½™é¢â€¦â€¦â€ï¼Œè€Œå­ç±»é‡å†™ <code>withdraw()</code> å‡½æ•°ä¹‹åï¼Œé’ˆå¯¹ <code>VIP</code> è´¦å·å®ç°äº†é€æ”¯æç°çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æç°é‡‘é¢å¯ä»¥å¤§äºè´¦æˆ·ä½™é¢ï¼Œé‚£è¿™ä¸ªå­ç±»çš„è®¾è®¡ä¹Ÿæ˜¯ä¸ç¬¦åˆé‡Œå¼æ›¿æ¢åŸåˆ™çš„ã€‚</p>
</li>
</ul>
<hr>
<h1 id="ğŸš©æ¥å£éš”ç¦»åŸåˆ™"><a href="#ğŸš©æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="ğŸš©æ¥å£éš”ç¦»åŸåˆ™"></a>ğŸš©æ¥å£éš”ç¦»åŸåˆ™</h1><p><code>(Interface Segregation Principle ç®€ç§° ISP)</code></p>
<h2 id="1-å¦‚ä½•ç†è§£-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ"><a href="#1-å¦‚ä½•ç†è§£-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ" class="headerlink" title="1 å¦‚ä½•ç†è§£ â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ"></a>1 å¦‚ä½•ç†è§£ â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ</h2><p><code>Clients should not be forced to depend upon interfaces that they do not use (å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«å¼ºè¿«ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚å…¶ä¸­çš„â€œå®¢æˆ·ç«¯â€ï¼Œå¯ä»¥ç†è§£ä¸ºæ¥å£çš„è°ƒç”¨è€…æˆ–è€…ä½¿ç”¨è€…)</code></p>
<p>åœ¨è¿™æ¡åŸåˆ™ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠâ€œæ¥å£â€ç†è§£ä¸ºä¸‹é¢ä¸‰ç§ä¸œè¥¿ï¼š</p>
<ul>
<li>ä¸€ç»„ <code>API</code> æ¥å£é›†åˆ</li>
<li>å•ä¸ª <code>API</code> æ¥å£æˆ–å‡½æ•°</li>
<li><code>OOP</code> ä¸­çš„æ¥å£æ¦‚å¿µ</li>
</ul>
<h2 id="2-å¦‚ä½•åšåˆ°-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ"><a href="#2-å¦‚ä½•åšåˆ°-â€œæ¥å£éš”ç¦»åŸåˆ™â€-ï¼Ÿ" class="headerlink" title="2 å¦‚ä½•åšåˆ° â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ"></a>2 å¦‚ä½•åšåˆ° â€œæ¥å£éš”ç¦»åŸåˆ™â€ ï¼Ÿ</h2><ul>
<li>ä¸€ç»„ <code>API</code> æ¥å£é›†åˆ</li>
</ul>
<p>å¾®æœåŠ¡ç”¨æˆ·ç³»ç»Ÿæä¾›äº†ä¸€ç»„è·Ÿç”¨æˆ·ç›¸å…³çš„ <code>API</code> ç»™å…¶ä»–ç³»ç»Ÿä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šæ³¨å†Œã€ç™»å½•ã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">register</span><span class="params">(String cellphone, String password)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">login</span><span class="params">(String cellphone, String password)</span></span>;</span><br><span class="line">  <span class="function">UserInfo <span class="title">getUserInfoById</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br><span class="line">  <span class="function">UserInfo <span class="title">getUserInfoByCellphone</span><span class="params">(String cellphone)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„åå°ç®¡ç†ç³»ç»Ÿè¦å®ç°åˆ é™¤ç”¨æˆ·çš„åŠŸèƒ½ï¼Œå¸Œæœ›ç”¨æˆ·ç³»ç»Ÿæä¾›ä¸€ä¸ªåˆ é™¤ç”¨æˆ·çš„æ¥å£ã€‚</p>
<p>åˆ é™¤ç”¨æˆ·æ˜¯ä¸€ä¸ªéå¸¸æ…é‡çš„æ“ä½œï¼Œæˆ‘ä»¬åªå¸Œæœ›é€šè¿‡åå°ç®¡ç†ç³»ç»Ÿæ¥æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ¥å£åªé™äºç»™åå°ç®¡ç†ç³»ç»Ÿä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬æŠŠå®ƒæ”¾åˆ° <code>UserService</code> ä¸­ï¼Œé‚£æ‰€æœ‰ä½¿ç”¨åˆ° <code>UserService</code> çš„ç³»ç»Ÿï¼Œéƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªæ¥å£ã€‚ä¸åŠ é™åˆ¶åœ°è¢«å…¶ä»–ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´è¯¯åˆ ç”¨æˆ·ã€‚</p>
<p>æˆ‘ä»¬å‚ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œè°ƒç”¨è€…ä¸åº”è¯¥å¼ºè¿«ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œå°†åˆ é™¤æ¥å£å•ç‹¬æ”¾åˆ°å¦å¤–ä¸€ä¸ªæ¥å£ <code>RestrictedUserService</code> ä¸­ï¼Œç„¶åå°† <code>RestrictedUserService</code> åªæ‰“åŒ…æä¾›ç»™åå°ç®¡ç†ç³»ç»Ÿæ¥ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RestrictedUserService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">deleteUserByCellphone</span><span class="params">(String cellphone)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">deleteUserById</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span>, <span class="title">RestrictedUserService</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...çœç•¥å®ç°ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆšåˆšçš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠæ¥å£éš”ç¦»åŸåˆ™ä¸­çš„æ¥å£ï¼Œç†è§£ä¸ºä¸€ç»„æ¥å£é›†åˆï¼Œå®ƒå¯ä»¥æ˜¯æŸä¸ªå¾®æœåŠ¡çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªç±»åº“çš„æ¥å£ç­‰ç­‰ã€‚</p>
<ul>
<li>å•ä¸ª <code>API</code> æ¥å£æˆ–å‡½æ•°</li>
</ul>
<p>æŠŠæ¥å£ç†è§£ä¸ºå•ä¸ªæ¥å£æˆ–å‡½æ•°ï¼Œé‚£æ¥å£éš”ç¦»åŸåˆ™å°±å¯ä»¥ç†è§£ä¸ºï¼šå‡½æ•°çš„è®¾è®¡è¦åŠŸèƒ½å•ä¸€ï¼Œä¸è¦å°†å¤šä¸ªä¸åŒçš„åŠŸèƒ½é€»è¾‘åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Statistics</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Long max;</span><br><span class="line">  <span class="keyword">private</span> Long min;</span><br><span class="line">  <span class="keyword">private</span> Long average;</span><br><span class="line">  <span class="keyword">private</span> Long sum;</span><br><span class="line">  <span class="keyword">private</span> Long percentile99;</span><br><span class="line">  <span class="keyword">private</span> Long percentile999;</span><br><span class="line">  <span class="comment">//...çœç•¥constructor/getter/setterç­‰æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Statistics <span class="title">count</span><span class="params">(Collection&lt;Long&gt; dataSet)</span> </span>&#123;</span><br><span class="line">  Statistics statistics = <span class="keyword">new</span> Statistics();</span><br><span class="line">  <span class="comment">//...çœç•¥è®¡ç®—é€»è¾‘ æ±‚æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼...</span></span><br><span class="line">  <span class="keyword">return</span> statistics;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠ <code>count()</code>  å‡½æ•°æ‹†æˆå‡ ä¸ªæ›´å°ç²’åº¦çš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°è´Ÿè´£ä¸€ä¸ªç‹¬ç«‹çš„ç»Ÿè®¡åŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">max</span><span class="params">(Collection&lt;Long&gt; dataSet)</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">min</span><span class="params">(Collection&lt;Long&gt; dataSet)</span> </span>&#123; <span class="comment">//... &#125; </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">average</span><span class="params">(Colletion&lt;Long&gt; dataSet)</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line"><span class="comment">// ...çœç•¥å…¶ä»–ç»Ÿè®¡å‡½æ•°...</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æŸç§æ„ä¹‰ä¸Šè®²ï¼Œ<code>count()</code> å‡½æ•°ä¹Ÿä¸èƒ½ç®—æ˜¯èŒè´£ä¸å¤Ÿå•ä¸€ï¼Œæ¯•ç«Ÿå®ƒåšçš„äº‹æƒ…åªè·Ÿç»Ÿè®¡ç›¸å…³ã€‚åˆ¤å®šåŠŸèƒ½æ˜¯å¦å•ä¸€ï¼Œé™¤äº†å¾ˆå¼ºçš„ä¸»è§‚æ€§ï¼Œè¿˜éœ€è¦ç»“åˆå…·ä½“çš„åœºæ™¯ã€‚</p>
<p>å¦‚æœåœ¨é¡¹ç›®ä¸­ï¼Œå¯¹æ¯ä¸ªç»Ÿè®¡éœ€æ±‚ï¼Œ<code>Statistics</code> å®šä¹‰çš„é‚£å‡ ä¸ªç»Ÿè®¡ä¿¡æ¯éƒ½æœ‰æ¶‰åŠï¼Œé‚£ <code>count()</code> å‡½æ•°çš„è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚å¦‚æœæ¯ä¸ªç»Ÿè®¡éœ€æ±‚åªæ¶‰åŠ <code>Statistics</code> ç½—åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ä¸­ä¸€éƒ¨åˆ†ï¼Œå°±ä¼šåšå¾ˆå¤šæ— ç”¨åŠŸï¼ŒåŠ¿å¿…å½±å“ä»£ç çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç»Ÿè®¡çš„æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ã€‚<code>count()</code> å‡½æ•°çš„è®¾è®¡å°±æœ‰ç‚¹ä¸åˆç†äº†ã€‚</p>
<ul>
<li><code>OOP</code> ä¸­çš„æ¥å£æ¦‚å¿µ</li>
</ul>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠâ€œæ¥å£â€ç†è§£ä¸º <code>OOP</code> ä¸­çš„æ¥å£æ¦‚å¿µï¼Œæ¯”å¦‚ <code>Java</code> ä¸­çš„ <code>interface</code>ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° å‡è®¾æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸‰ä¸ªå¤–éƒ¨ç³»ç»Ÿï¼š<code>Redis</code>ã€<code>MySQL</code>ã€<code>Kafka</code>ã€‚æ¯ä¸ªç³»ç»Ÿéƒ½å¯¹åº”ä¸€ç³»åˆ—é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚åœ°å€ã€ç«¯å£ã€è®¿é—®è¶…æ—¶æ—¶é—´ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ConfigSource configSource; <span class="comment">//é…ç½®ä¸­å¿ƒï¼ˆæ¯”å¦‚zookeeperï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeout;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxTotal;</span><br><span class="line">    <span class="comment">//çœç•¥å…¶ä»–é…ç½®: maxWaitMillis,maxIdle,minIdle...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisConfig</span><span class="params">(ConfigSource configSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.configSource = configSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...çœç•¥å…¶ä»–get()ã€init()æ–¹æ³•...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»configSourceåŠ è½½é…ç½®åˆ°address/timeout/maxTotal...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConfig</span> </span>&#123; <span class="comment">//...çœç•¥... &#125;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlConfig</span> </span>&#123; <span class="comment">//...çœç•¥... &#125;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„åŠŸèƒ½éœ€æ±‚ï¼Œä»¥å›ºå®šæ—¶é—´é¢‘ç‡ï¼ˆ<code>periodInSeconds</code>ï¼‰æ¥è°ƒç”¨ <code>RedisConfig</code>ã€<code>KafkaConfig</code> çš„ <code>update()</code> æ–¹æ³•æ›´æ–°é…ç½®ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Updater</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="title">implemets</span> <span class="title">Updater</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConfig</span> <span class="keyword">implements</span> <span class="title">Updater</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlConfig</span> </span>&#123; <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•... &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledUpdater</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduledExecutorService executor = Executors.newSingleThreadScheduledExecutor();;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> initialDelayInSeconds;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> periodInSeconds;</span><br><span class="line">    <span class="keyword">private</span> Updater updater;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScheduleUpdater</span><span class="params">(Updater updater, <span class="keyword">long</span> initialDelayInSeconds, <span class="keyword">long</span> periodInSeconds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.updater = updater;</span><br><span class="line">        <span class="keyword">this</span>.initialDelayInSeconds = initialDelayInSeconds;</span><br><span class="line">        <span class="keyword">this</span>.periodInSeconds = periodInSeconds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        executor.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                updater.update();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">this</span>.initialDelayInSeconds, <span class="keyword">this</span>.periodInSeconds, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  ConfigSource configSource = <span class="keyword">new</span> ZookeeperConfigSource(<span class="comment">/*çœç•¥å‚æ•°*/</span>);</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> RedisConfig redisConfig = <span class="keyword">new</span> RedisConfig(configSource);</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> KafkaConfig kafkaConfig = <span class="keyword">new</span> KakfaConfig(configSource);</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MySqlConfig mysqlConfig = <span class="keyword">new</span> MysqlConfig(configSource);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ScheduledUpdater redisConfigUpdater = <span class="keyword">new</span> ScheduledUpdater(redisConfig, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    redisConfigUpdater.run();</span><br><span class="line">    </span><br><span class="line">    ScheduledUpdater kafkaConfigUpdater = <span class="keyword">new</span> ScheduledUpdater(kafkaConfig, <span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line">    redisConfigUpdater.run();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°çš„ <code>ScheduledUpdater</code> ç±»ï¼Œåªä¾èµ– <code>Updater</code> è¿™ä¸ªç›¸å…³çš„æ¥å£ï¼Œä¸éœ€è¦è¢«å¼ºè¿«å»ä¾èµ–ä¸éœ€è¦çš„ <code>Viewer</code> æ¥å£ï¼Œæ»¡è¶³æ¥å£éš”ç¦»åŸåˆ™ã€‚åŠŸèƒ½æ˜¯å®šæ—¶è°ƒç”¨ä¼ å…¥çš„ <code>Updater</code> çš„ <code>update</code>  æ–¹æ³•ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åˆæœ‰äº†ä¸€ä¸ªæ–°çš„ç›‘æ§åŠŸèƒ½éœ€æ±‚ã€‚æˆ‘ä»¬æƒ³æš´éœ² <code>MySQL</code> å’Œ <code>Redis</code> çš„é…ç½®ä¿¡æ¯ï¼Œè¾“å‡ºé¡¹ç›®çš„é…ç½®ä¿¡æ¯åˆ°ä¸€ä¸ªå›ºå®šçš„ HTTP åœ°å€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Viewer</span> </span>&#123;</span><br><span class="line">  <span class="function">String <span class="title">outputInPlainText</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">Map&lt;String, String&gt; <span class="title">output</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="title">implemets</span> <span class="title">Updater</span>, <span class="title">Viewer</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">outputInPlainText</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">output</span><span class="params">()</span> </span>&#123; <span class="comment">//...&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConfig</span> <span class="keyword">implements</span> <span class="title">Updater</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlConfig</span> <span class="keyword">implements</span> <span class="title">Viewer</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">outputInPlainText</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">output</span><span class="params">()</span> </span>&#123; <span class="comment">//...&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHttpServer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String host;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;String, List&lt;Viewer&gt;&gt; viewers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SimpleHttpServer</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;<span class="comment">//...&#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewers</span><span class="params">(String urlDirectory, Viewer viewer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!viewers.containsKey(urlDirectory)) &#123;</span><br><span class="line">      viewers.put(urlDirectory, <span class="keyword">new</span> ArrayList&lt;Viewer&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.viewers.get(urlDirectory).add(viewer);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    ConfigSource configSource = <span class="keyword">new</span> ZookeeperConfigSource();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> RedisConfig redisConfig = <span class="keyword">new</span> RedisConfig(configSource);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> KafkaConfig kafkaConfig = <span class="keyword">new</span> KakfaConfig(configSource);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MySqlConfig mysqlConfig = <span class="keyword">new</span> MySqlConfig(configSource);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ScheduledUpdater redisConfigUpdater =<span class="keyword">new</span> ScheduledUpdater(redisConfig, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">        redisConfigUpdater.run();</span><br><span class="line">        </span><br><span class="line">        ScheduledUpdater kafkaConfigUpdater =<span class="keyword">new</span> ScheduledUpdater(kafkaConfig, <span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line">        kafkaConfigUpdater.run();</span><br><span class="line">        </span><br><span class="line">        SimpleHttpServer simpleHttpServer = <span class="keyword">new</span> SimpleHttpServer(â€œ<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>â€, <span class="number">2389</span>);</span><br><span class="line">        simpleHttpServer.addViewer(<span class="string">"/config"</span>, redisConfig);</span><br><span class="line">        simpleHttpServer.addViewer(<span class="string">"/config"</span>, mysqlConfig);</span><br><span class="line">        simpleHttpServer.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SimpleHttpServer</code> åªä¾èµ–è·ŸæŸ¥çœ‹ä¿¡æ¯ç›¸å…³çš„ <code>Viewer</code> æ¥å£ï¼Œä¸ä¾èµ–ä¸éœ€è¦çš„ <code>Updater</code> æ¥å£ï¼Œä¹Ÿæ»¡è¶³æ¥å£éš”ç¦»åŸåˆ™ã€‚</p>
<p>è¿™ç§æ–¹å¼æ¯”æ™®é€šå¤§è€Œå…¨çš„ <code>Config</code> æ¥å£æ›´åŠ çµæ´»ã€æ˜“æ‰©å±•ã€æ˜“å¤ç”¨ï¼Œå› ä¸º <code>Updater</code>ã€<code>Viewer</code> èŒè´£æ›´åŠ å•ä¸€ï¼Œæ·»åŠ æ–°éœ€æ±‚ä¹Ÿå®¹æ˜“åº”å¯¹ã€‚åŒæ—¶ä¹Ÿé˜²æ­¢äº†é‡å†™æ— ç”¨çš„æ¥å£ï¼Œå¯è¯»æ€§æ›´é«˜ã€‚</p>
<h2 id="3-æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«"><a href="#3-æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«" class="headerlink" title="3 æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«"></a>3 æ¥å£éš”ç¦»åŸåˆ™ä¸å•ä¸€èŒè´£åŸåˆ™çš„åŒºåˆ«</h2><p>å•ä¸€èŒè´£åŸåˆ™é’ˆå¯¹çš„æ˜¯æ¨¡å—ã€ç±»ã€æ¥å£çš„è®¾è®¡ã€‚</p>
<p>æ¥å£éš”ç¦»åŸåˆ™ç›¸å¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸€æ–¹é¢æ›´ä¾§é‡äºæ¥å£çš„è®¾è®¡ï¼Œå¦ä¸€æ–¹é¢å®ƒçš„æ€è€ƒè§’åº¦ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p>
<p>æ¥å£éš”ç¦»åŸåˆ™æä¾›äº†ä¸€ç§åˆ¤æ–­æ¥å£çš„èŒè´£æ˜¯å¦å•ä¸€çš„æ ‡å‡†ï¼šé€šè¿‡è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£æ¥é—´æ¥åœ°åˆ¤å®šã€‚å¦‚æœè°ƒç”¨è€…åªä½¿ç”¨éƒ¨åˆ†æ¥å£æˆ–æ¥å£çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æ¥å£çš„è®¾è®¡å°±ä¸å¤ŸèŒè´£å•ä¸€ã€‚</p>
<hr>
<h1 id="ğŸš©ä¾èµ–åè½¬åŸåˆ™"><a href="#ğŸš©ä¾èµ–åè½¬åŸåˆ™" class="headerlink" title="ğŸš©ä¾èµ–åè½¬åŸåˆ™"></a>ğŸš©ä¾èµ–åè½¬åŸåˆ™</h1><p>åœ¨è®² â€œä¾èµ–åè½¬åŸåˆ™ <code>(Dependency Inversion Principe ç®€ç§° DIP)</code>â€ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®²ä¸€è®²åŸºç¡€çŸ¥è¯†ã€‚</p>
<h2 id="1-æ§åˆ¶åè½¬"><a href="#1-æ§åˆ¶åè½¬" class="headerlink" title="1 æ§åˆ¶åè½¬"></a>1 æ§åˆ¶åè½¬</h2><p><code>ï¼ˆ Inversion Of Control IOCï¼‰</code></p>
<p>è¿™é‡Œçš„ â€æ§åˆ¶â€ æŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œ â€œåè½¬â€ æŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæµç¨‹å¯ä»¥é€šè¿‡æ¡†æ¶æ¥æ§åˆ¶ã€‚æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜ â€œåè½¬â€ åˆ°äº†æ¡†æ¶ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">doTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;<span class="comment">//è¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥æ”¾åˆ°æ¡†æ¶ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (doTest()) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Test succeed."</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">"Test failed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰çš„æµç¨‹éƒ½ç”±ç¨‹åºå‘˜æ¥æ§åˆ¶ã€‚æˆ‘ä»¬å†æ¥çœ‹ï¼Œå¦‚ä½•åˆ©ç”¨ â€æ§åˆ¶åè½¬â€œ æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆæ˜¯æ¡†æ¶ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (doTest()) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Test succeed."</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">"Test failed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">doTest</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JunitApplication</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;TestCase&gt; testCases = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(TestCase testCase)</span> </span>&#123;</span><br><span class="line">    testCases.add(testCase);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (TestCase <span class="keyword">case</span>: testCases) &#123;</span><br><span class="line">      <span class="keyword">case</span>.run();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦åœ¨æ¡†æ¶é¢„ç•™çš„æ‰©å±•ç‚¹ï¼Œä¹Ÿå°±æ˜¯ <code>TestCase</code> ç±»ä¸­çš„ <code>doTest()</code> æŠ½è±¡å‡½æ•°ä¸­ï¼Œå¡«å……å…·ä½“çš„æµ‹è¯•ä»£ç å°±å¯ä»¥å®ç°ä¹‹å‰çš„åŠŸèƒ½äº†ï¼Œå®Œå…¨ä¸éœ€è¦å†™è´Ÿè´£æ‰§è¡Œæµç¨‹çš„ <code>main()</code> å‡½æ•°äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doTest</span><span class="params">()</span> </span>&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ“ä½œè¿˜å¯ä»¥é€šè¿‡é…ç½®çš„æ–¹å¼æ¥å®ç°ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºè°ƒç”¨register()</span></span><br><span class="line">JunitApplication.register(<span class="keyword">new</span> UserServiceTest();</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯å…¸å‹çš„é€šè¿‡æ¡†æ¶æ¥å®ç° â€œæ§åˆ¶åè½¬â€ çš„ä¾‹å­ã€‚</p>
<p>æ¡†æ¶æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„ä»£ç éª¨æ¶ï¼Œç”¨æ¥ç»„è£…å¯¹è±¡ã€ç®¡ç†æ•´ä¸ªæ‰§è¡Œæµç¨‹ã€‚<br>ç¨‹åºå‘˜åˆ©ç”¨æ¡†æ¶è¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œåªéœ€è¦å¾€é¢„ç•™çš„æ‰©å±•ç‚¹ä¸Šï¼Œæ·»åŠ è·Ÿè‡ªå·±ä¸šåŠ¡ç›¸å…³çš„ä»£ç ï¼Œå°±å¯ä»¥åˆ©ç”¨æ¡†æ¶æ¥é©±åŠ¨æ•´ä¸ªç¨‹åºæµç¨‹çš„æ‰§è¡Œã€‚</p>
<p>æ§åˆ¶åè½¬å¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„å®ç°æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç¬¼ç»Ÿçš„è®¾è®¡æ€æƒ³ï¼Œä¸€èˆ¬ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚</p>
<h2 id="2-ä¾èµ–æ³¨å…¥"><a href="#2-ä¾èµ–æ³¨å…¥" class="headerlink" title="2 ä¾èµ–æ³¨å…¥"></a>2 ä¾èµ–æ³¨å…¥</h2><p><code>ï¼ˆDependency Injection DIï¼‰</code></p>
<p>æœ‰ä¸€ä¸ªéå¸¸å½¢è±¡çš„è¯´æ³•ï¼Œé‚£å°±æ˜¯ï¼šä¾èµ–æ³¨å…¥æ˜¯ä¸€ä¸ªæ ‡ä»· <code>25</code> ç¾å…ƒï¼Œå®é™…ä¸Šåªå€¼ <code>5</code> ç¾åˆ†çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥å¾ˆ â€œé«˜å¤§ä¸Šâ€ ï¼Œå®é™…ä¸Šï¼Œç†è§£ã€åº”ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚</p>
<p>é‚£åˆ°åº•ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥å‘¢ï¼Ÿ<br>æˆ‘ä»¬ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯ï¼šä¸é€šè¿‡ <code>new()</code> çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–æ³¨å…¥ï¼‰ç»™ç±»ä½¿ç”¨ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Notification</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> MessageSender messageSender;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é€šè¿‡æ„é€ å‡½æ•°å°†messageSenderä¼ é€’è¿›æ¥</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Notification</span><span class="params">(MessageSender messageSender)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.messageSender = messageSender;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String cellphone, String message)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...çœç•¥æ ¡éªŒé€»è¾‘ç­‰...</span></span><br><span class="line">    <span class="keyword">this</span>.messageSender.send(cellphone, message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨Notification</span></span><br><span class="line">MessageSender messageSender = <span class="keyword">new</span> MessageSender();</span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification(messageSender);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥å°†ä¾èµ–çš„ç±»å¯¹è±¡ä¼ é€’è¿›æ¥ï¼Œè¿™æ ·å°±æé«˜äº†ä»£ç çš„æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»åœ°æ›¿æ¢ä¾èµ–çš„ç±»ã€‚</p>
<p>è¿™ä¸€ç‚¹åœ¨æˆ‘ä»¬ä¹‹å‰è®² â€œå¼€é—­åŸåˆ™â€ çš„æ—¶å€™ä¹Ÿæåˆ°è¿‡ã€‚</p>
<p>ä¸Šé¢ä»£ç è¿˜æœ‰ç»§ç»­ä¼˜åŒ–çš„ç©ºé—´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŠŠ MessageSender å®šä¹‰æˆæ¥å£ï¼Œ<strong>åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Notification</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> MessageSender messageSender;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Notification</span><span class="params">(MessageSender messageSender)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.messageSender = messageSender;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String cellphone, String message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.messageSender.send(cellphone, message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MessageSender</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">send</span><span class="params">(String cellphone, String message)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çŸ­ä¿¡å‘é€ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsSender</span> <span class="keyword">implements</span> <span class="title">MessageSender</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String cellphone, String message)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç«™å†…ä¿¡å‘é€ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InboxSender</span> <span class="keyword">implements</span> <span class="title">MessageSender</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String cellphone, String message)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨Notification</span></span><br><span class="line">MessageSender messageSender = <span class="keyword">new</span> SmsSender();</span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification(messageSender);</span><br></pre></td></tr></table></figure>

<p>ä¾èµ–æ³¨å…¥éå¸¸ç®€å•ï¼Œä½†å´éå¸¸æœ‰ç”¨ï¼ï¼å®ƒæ˜¯ç¼–å†™å¯æµ‹è¯•æ€§ä»£ç æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚</p>
<p><strong>â€œåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€ è·Ÿ â€œä¾èµ–æ³¨å…¥â€ ï¼Œçœ‹èµ·æ¥éå¸¸ç±»ä¼¼ï¼Œé‚£å®ƒä¿©æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»å‘¢ï¼Ÿ</strong></p>
<p>äºŒè€…éƒ½æ˜¯ä»å¤–éƒ¨ä¼ å…¥ä¾èµ–å¯¹è±¡è€Œä¸æ˜¯åœ¨å†…éƒ¨å» <code>new</code> ä¸€ä¸ªå‡ºæ¥ã€‚</p>
<p>åŒºåˆ«æ˜¯ â€œåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€ å¼ºè°ƒçš„æ˜¯ â€œæ¥å£â€ ï¼Œå¼ºè°ƒä¾èµ–çš„å¯¹è±¡æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°ç±»ï¼›è€Œ â€œä¾èµ–æ³¨å…¥â€ ä¸å¼ºè°ƒè¿™ä¸ªï¼Œç±»æˆ–æ¥å£éƒ½å¯ä»¥ï¼Œåªè¦æ˜¯ä»å¤–éƒ¨ä¼ å…¥ä¸æ˜¯åœ¨å†…éƒ¨ <code>new</code> å‡ºæ¥éƒ½å¯ä»¥ç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚</p>
<h2 id="3-ä¾èµ–åè½¬åŸåˆ™"><a href="#3-ä¾èµ–åè½¬åŸåˆ™" class="headerlink" title="3 ä¾èµ–åè½¬åŸåˆ™"></a>3 ä¾èµ–åè½¬åŸåˆ™</h2><p><code>ï¼ˆDependency Inversion Principle DIPï¼‰</code></p>
<p><code>High-level modules shouldnâ€™t depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldnâ€™t depend on details. Details depend on abstractions. (é«˜å±‚æ¨¡å—ï¼ˆhigh-level modulesï¼‰ä¸è¦ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆlow-levelï¼‰ã€‚é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—åº”è¯¥é€šè¿‡æŠ½è±¡ï¼ˆabstractionsï¼‰æ¥äº’ç›¸ä¾èµ–ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒæŠ½è±¡ï¼ˆabstractionsï¼‰ä¸è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼ˆdetailsï¼‰ï¼Œå…·ä½“å®ç°ç»†èŠ‚ï¼ˆdetailsï¼‰ä¾èµ–æŠ½è±¡ï¼ˆabstractionsï¼‰ã€‚)</code></p>
<p>æ‰€è°“é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—çš„åˆ’åˆ†ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œåœ¨è°ƒç”¨é“¾ä¸Šï¼Œ<strong>è°ƒç”¨è€…</strong> å±äºé«˜å±‚ï¼Œ<strong>è¢«è°ƒç”¨è€…</strong> å±äºä½å±‚ã€‚</p>
<p>ä¾èµ–åè½¬åŸåˆ™ä¹Ÿå«ä½œä¾èµ–å€’ç½®åŸåˆ™ã€‚è¿™æ¡åŸåˆ™è·Ÿæ§åˆ¶åè½¬æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸»è¦ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° </p>
<p><code>Tomcat</code> æ˜¯è¿è¡Œ <code>Java Web</code> åº”ç”¨ç¨‹åºçš„å®¹å™¨ã€‚<br>æˆ‘ä»¬ç¼–å†™çš„ <code>Web</code> åº”ç”¨ç¨‹åºä»£ç åªéœ€è¦éƒ¨ç½²åœ¨ <code>Tomcat</code> å®¹å™¨ä¸‹ï¼Œä¾¿å¯ä»¥è¢« <code>Tomcat</code> å®¹å™¨è°ƒç”¨æ‰§è¡Œã€‚æŒ‰ç…§ä¹‹å‰çš„åˆ’åˆ†åŸåˆ™ï¼Œ<code>Tomcat</code> å°±æ˜¯é«˜å±‚æ¨¡å—ï¼Œæˆ‘ä»¬ç¼–å†™çš„ <code>Web</code> åº”ç”¨ç¨‹åºä»£ç å°±æ˜¯ä½å±‚æ¨¡å—ã€‚<code>Tomcat</code> å’Œåº”ç”¨ç¨‹åºä»£ç ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œä¸¤è€…éƒ½ä¾èµ–åŒä¸€ä¸ª â€œæŠ½è±¡â€ ï¼Œä¹Ÿå°±æ˜¯ <code>Servlet</code> è§„èŒƒã€‚<code>Servlet</code> è§„èŒƒä¸ä¾èµ–å…·ä½“çš„ <code>Tomcat</code> å®¹å™¨å’Œåº”ç”¨ç¨‹åºçš„å®ç°ç»†èŠ‚ï¼Œè€Œ <code>Tomcat</code> å®¹å™¨å’Œåº”ç”¨ç¨‹åºä¾èµ– <code>Servlet</code> è§„èŒƒã€‚</p>
<hr>
<h1 id="ğŸš©KISS-åŸåˆ™"><a href="#ğŸš©KISS-åŸåˆ™" class="headerlink" title="ğŸš©KISS åŸåˆ™"></a>ğŸš©KISS åŸåˆ™</h1><p><code>Keep It Simple and Stupid.</code>  </p>
<p><code>Keep It Short and Simple.</code>   </p>
<p><code>Keep It Simple and Straightforward.</code> </p>
<p><code>(å°½é‡ä¿æŒç®€å•ã€‚)</code></p>
<p>ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ˜¯è¡¡é‡ä»£ç è´¨é‡éå¸¸é‡è¦çš„ä¸¤ä¸ªæ ‡å‡†ã€‚è€Œ <code>KISS</code> åŸåˆ™å°±æ˜¯ä¿æŒä»£ç å¯è¯»å’Œå¯ç»´æŠ¤çš„é‡è¦æ‰‹æ®µã€‚ä»£ç è¶³å¤Ÿç®€å•ï¼Œä¹Ÿå°±æ„å‘³ç€å¾ˆå®¹æ˜“è¯»æ‡‚ï¼Œ<code>bug</code> æ¯”è¾ƒéš¾éšè—ã€‚å³ä¾¿å‡ºç° <code>bug</code>ï¼Œä¿®å¤èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<h2 id="1-ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ"><a href="#1-ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ" class="headerlink" title="1 ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ"></a>1 ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€å—ï¼Ÿ</h2><p>ä¸¾å‡ ä¸ªæ —å­ğŸŒ° å¯¹æ¯”ä¸€ä¸‹ã€‚ æ£€æŸ¥è¾“å…¥çš„å­—ç¬¦ä¸² <code>ipAddress</code> æ˜¯å¦æ˜¯åˆæ³•çš„ IP åœ°å€ã€‚ä¸€ä¸ªåˆæ³•çš„ <code>IP</code> åœ°å€ç”±å››ä¸ªæ•°å­—ç»„æˆï¼Œå¹¶ä¸”é€šè¿‡ â€œ.â€ æ¥è¿›è¡Œåˆ†å‰²ã€‚æ¯ç»„æ•°å­—çš„å–å€¼èŒƒå›´æ˜¯ <code>0~255</code>ã€‚ç¬¬ä¸€ç»„æ•°å­—æ¯”è¾ƒç‰¹æ®Šï¼Œä¸å…è®¸ä¸º <code>0</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§å®ç°æ–¹å¼: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidIpAddressV1</span><span class="params">(String ipAddress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  String regex = <span class="string">"^(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$"</span>;</span><br><span class="line">  <span class="keyword">return</span> ipAddress.matches(regex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§å®ç°æ–¹å¼: ä½¿ç”¨ç°æˆçš„å·¥å…·ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidIpAddressV2</span><span class="params">(String ipAddress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  String[] ipUnits = StringUtils.split(ipAddress, <span class="string">'.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (ipUnits.length != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> ipUnitIntValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ipUnitIntValue = Integer.parseInt(ipUnits[i]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; ipUnitIntValue == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰ç§å®ç°æ–¹å¼: ä¸ä½¿ç”¨ä»»ä½•å·¥å…·ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidIpAddressV3</span><span class="params">(String ipAddress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span>[] ipChars = ipAddress.toCharArray();</span><br><span class="line">  <span class="keyword">int</span> length = ipChars.length;</span><br><span class="line">  <span class="keyword">int</span> ipUnitIntValue = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">boolean</span> isFirstUnit = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">int</span> unitsCount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">    <span class="keyword">char</span> c = ipChars[i];</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">'.'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (isFirstUnit &amp;&amp; ipUnitIntValue == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (isFirstUnit) isFirstUnit = <span class="keyword">false</span>;</span><br><span class="line">      ipUnitIntValue = -<span class="number">1</span>;</span><br><span class="line">      unitsCount++;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ipUnitIntValue == -<span class="number">1</span>) ipUnitIntValue = <span class="number">0</span>;</span><br><span class="line">    ipUnitIntValue = ipUnitIntValue * <span class="number">10</span> + (c - <span class="string">'0'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (unitsCount != <span class="number">3</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç¬¬ä¸€ç§å®ç°æ–¹å¼åˆ©ç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼<br>åªç”¨ä¸‰è¡Œä»£ç å°±æŠŠè¿™ä¸ªé—®é¢˜æå®šäº†ã€‚å®ƒçš„ä»£ç è¡Œæ•°æœ€å°‘ï¼Œé‚£æ˜¯ä¸æ˜¯å°±æœ€ç¬¦åˆ KISS åŸåˆ™å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è™½ç„¶ä»£ç è¡Œæ•°æœ€å°‘ï¼Œçœ‹ä¼¼æœ€ç®€å•ï¼Œå®é™…ä¸Šå´å¾ˆå¤æ‚ã€‚è¿™æ­£æ˜¯å› ä¸ºå®ƒä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>ä¸€æ–¹é¢ï¼Œæ­£åˆ™è¡¨è¾¾å¼æœ¬èº«æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå†™å‡ºå®Œå…¨æ²¡æœ‰ <code>bug</code> çš„æ­£åˆ™è¡¨è¾¾æœ¬èº«å°±æ¯”è¾ƒæœ‰æŒ‘æˆ˜ï¼›å¦ä¸€æ–¹é¢ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªç¨‹åºå‘˜éƒ½ç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‚è¿™ç§å®ç°æ–¹å¼ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§å˜å·®ï¼Œæ‰€ä»¥ï¼Œä» <code>KISS</code> åŸåˆ™çš„è®¾è®¡åˆè¡·ä¸Šæ¥è®²ï¼Œè¿™ç§å®ç°æ–¹å¼å¹¶ä¸ç¬¦åˆ <code>KISS</code> åŸåˆ™ã€‚</p>
</li>
<li><p>ç¬¬äºŒç§å®ç°æ–¹å¼ä½¿ç”¨äº† <code>StringUtils</code> ç±»ã€<code>Integer</code> ç±»æä¾›çš„ä¸€äº›ç°æˆçš„å·¥å…·å‡½æ•°å¤„ç† <code>IP</code> åœ°å€å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰ç§å®ç°æ–¹å¼ï¼Œä¸ä½¿ç”¨ä»»ä½•å·¥å…·å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡é€ä¸€å¤„ç† <code>IP</code> åœ°å€ä¸­çš„å­—ç¬¦ï¼Œæ¥åˆ¤æ–­æ˜¯å¦åˆæ³•ã€‚</p>
<p>ç¬¬ä¸‰ç§å®ç°æ–¹å¼å®Œå…¨æ˜¯è‡ªå·±æ“ä½œåº•å±‚å­—ç¬¦ï¼Œåªé’ˆå¯¹ <code>IP</code> åœ°å€è¿™ä¸€ç§æ ¼å¼çš„æ•°æ®è¾“å…¥æ¥åšå¤„ç†ï¼Œæ²¡æœ‰å¤ªå¤šå¤šä½™çš„å‡½æ•°è°ƒç”¨å’Œå…¶ä»–ä¸å¿…è¦çš„å¤„ç†é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œæ•ˆç‡ä¸Šï¼Œè¿™ç§ç±»ä¼¼å®šåˆ¶åŒ–çš„å¤„ç†ä»£ç æ–¹å¼è‚¯å®šæ¯”é€šç”¨çš„å·¥å…·ç±»è¦é«˜äº›ã€‚</p>
<p>ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå°½ç®¡ç¬¬ä¸‰ç§å®ç°æ–¹å¼æ€§èƒ½æ›´é«˜äº›ï¼Œä½†è¿˜æ˜¯æ›´å€¾å‘äºé€‰æ‹©ç¬¬äºŒç§å®ç°æ–¹æ³•ã€‚é‚£æ˜¯å› ä¸ºç¬¬ä¸‰ç§å®ç°æ–¹å¼å®é™…ä¸Šæ˜¯ä¸€ç§è¿‡åº¦ä¼˜åŒ–ã€‚é™¤é <code>isValidIpAddress()</code> å‡½æ•°æ˜¯å½±å“ç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆä»£ç ï¼Œå¦åˆ™ï¼Œè¿™æ ·ä¼˜åŒ–çš„æŠ•å…¥äº§å‡ºæ¯”å¹¶ä¸é«˜ï¼Œå¢åŠ äº†ä»£ç å®ç°çš„éš¾åº¦ã€ç‰ºç‰²äº†ä»£ç çš„å¯è¯»æ€§ï¼Œæ€§èƒ½ä¸Šçš„æå‡å´å¹¶ä¸æ˜æ˜¾ã€‚</p>
<p>ä»ä»£ç è¡Œæ•°ä¸Šæ¥è¯´ï¼Œè¿™ä¸¤ç§æ–¹å¼å·®ä¸å¤šã€‚ä½†æ˜¯ï¼Œç¬¬ä¸‰ç§è¦æ¯”ç¬¬äºŒç§æ›´åŠ æœ‰éš¾åº¦ï¼Œæ›´å®¹æ˜“å†™å‡º <code>bug</code>ã€‚</p>
<p>ä»å¯è¯»æ€§ä¸Šæ¥è¯´ï¼Œç¬¬äºŒç§å®ç°æ–¹å¼çš„ä»£ç é€»è¾‘æ›´æ¸…æ™°ã€æ›´å¥½ç†è§£ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨è¿™ä¸¤ç§å®ç°æ–¹å¼ä¸­ï¼Œç¬¬äºŒç§å®ç°æ–¹å¼æ›´åŠ  â€œç®€å•â€ ï¼Œæ›´åŠ ç¬¦åˆ <code>KISS</code> åŸåˆ™ã€‚</p>
</li>
</ul>
<h2 id="2-ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ-KISS-åŸåˆ™å—ï¼Ÿ"><a href="#2-ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ-KISS-åŸåˆ™å—ï¼Ÿ" class="headerlink" title="2 ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ KISS åŸåˆ™å—ï¼Ÿ"></a>2 ä»£ç é€»è¾‘å¤æ‚å°±è¿èƒŒ KISS åŸåˆ™å—ï¼Ÿ</h2><p>åˆšåˆšæˆ‘ä»¬æåˆ°ï¼Œå¹¶ä¸æ˜¯ä»£ç è¡Œæ•°è¶Šå°‘å°±è¶Šâ€œç®€å•â€ï¼Œè¿˜è¦è€ƒè™‘é€»è¾‘å¤æ‚åº¦ã€å®ç°éš¾åº¦ã€ä»£ç çš„å¯è¯»æ€§ç­‰ã€‚é‚£å¦‚æœä¸€æ®µä»£ç çš„é€»è¾‘å¤æ‚ã€å®ç°éš¾åº¦å¤§ã€å¯è¯»æ€§ä¹Ÿä¸å¤ªå¥½ï¼Œæ˜¯ä¸æ˜¯å°±ä¸€å®šè¿èƒŒ <code>KISS</code> åŸåˆ™å‘¢ï¼Ÿå…¶å®è¿™ä¹Ÿæ˜¯ç”±ä¸šåŠ¡åœºæ™¯å†³å®šçš„ã€‚ä¸¾ä¸ªæ —å­ğŸŒ° </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// KMP algorithm: a, båˆ†åˆ«æ˜¯ä¸»ä¸²å’Œæ¨¡å¼ä¸²ï¼›n, måˆ†åˆ«æ˜¯ä¸»ä¸²å’Œæ¨¡å¼ä¸²çš„é•¿åº¦ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(<span class="keyword">char</span>[] a, <span class="keyword">int</span> n, <span class="keyword">char</span>[] b, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span>[] next = getNexts(b, m);</span><br><span class="line">  <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; a[i] != b[j]) &#123; <span class="comment">// ä¸€ç›´æ‰¾åˆ°a[i]å’Œb[j]</span></span><br><span class="line">      j = next[j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (a[i] == b[j]) &#123;</span><br><span class="line">      ++j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j == m) &#123; <span class="comment">// æ‰¾åˆ°åŒ¹é…æ¨¡å¼ä¸²çš„äº†</span></span><br><span class="line">      <span class="keyword">return</span> i - m + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bè¡¨ç¤ºæ¨¡å¼ä¸²ï¼Œmè¡¨ç¤ºæ¨¡å¼ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] getNexts(<span class="keyword">char</span>[] b, <span class="keyword">int</span> m) &#123;</span><br><span class="line">  <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[m];</span><br><span class="line">  next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> k = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">    <span class="keyword">while</span> (k != -<span class="number">1</span> &amp;&amp; b[k + <span class="number">1</span>] != b[i]) &#123;</span><br><span class="line">      k = next[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (b[k + <span class="number">1</span>] == b[i]) &#123;</span><br><span class="line">      ++k;</span><br><span class="line">    &#125;</span><br><span class="line">    next[i] = k;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€æ®µ <code>KMP</code> å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå®ƒä»¥å¿«é€Ÿé«˜æ•ˆè‘—ç§°ã€‚<code>KMP</code> å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•å®Œå…¨ç¬¦åˆæˆ‘ä»¬åˆšæåˆ°çš„é€»è¾‘å¤æ‚ã€å®ç°éš¾åº¦å¤§ã€å¯è¯»æ€§å·®çš„ç‰¹ç‚¹ï¼Œä½†å½“æˆ‘ä»¬éœ€è¦å¤„ç†é•¿æ–‡æœ¬å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ï¼ˆå‡ ç™¾ <code>MB</code> å¤§å°æ–‡æœ¬å†…å®¹çš„åŒ¹é…ï¼‰ï¼Œæˆ–è€…å­—ç¬¦ä¸²åŒ¹é…æ˜¯æŸä¸ªäº§å“çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ¯”å¦‚ <code>Vim</code>ã€<code>Word</code> ç­‰æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ï¼Œåˆæˆ–è€…å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•æ˜¯ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆçš„æ—¶å€™ï¼Œè¿™æ—¶å®ƒå¹¶ä¸è¿å <code>KISS</code> åŸåˆ™ã€‚</p>
<p>æœ¬èº«å°±å¤æ‚çš„é—®é¢˜ï¼Œç”¨å¤æ‚çš„æ–¹æ³•è§£å†³ï¼Œå¹¶ä¸è¿èƒŒ <code>KISS</code> åŸåˆ™ã€‚</p>
<p>ä¸è¿‡ï¼Œå¹³æ—¶çš„é¡¹ç›®å¼€å‘ä¸­æ¶‰åŠçš„å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é’ˆå¯¹æ¯”è¾ƒå°çš„æ–‡æœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›´æ¥è°ƒç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„ç°æˆçš„å­—ç¬¦ä¸²åŒ¹é…å‡½æ•°å°±è¶³å¤Ÿäº†ã€‚å¦‚æœéå¾—ç”¨ <code>KMP</code> ç®—æ³•ã€BM ç®—æ³•æ¥å®ç°å­—ç¬¦ä¸²åŒ¹é…ï¼Œé‚£å°±çœŸçš„è¿èƒŒ <code>KISS</code> åŸåˆ™äº†ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„ä»£ç ï¼Œåœ¨æŸä¸ªä¸šåŠ¡åœºæ™¯ä¸‹æ»¡è¶³ <code>KISS</code> åŸåˆ™ï¼Œæ¢ä¸€ä¸ªåº”ç”¨åœºæ™¯å¯èƒ½å°±ä¸æ»¡è¶³äº†ã€‚</p>
<h2 id="3-å¦‚ä½•å†™å‡ºæ»¡è¶³-KISS-åŸåˆ™çš„ä»£ç ï¼Ÿ"><a href="#3-å¦‚ä½•å†™å‡ºæ»¡è¶³-KISS-åŸåˆ™çš„ä»£ç ï¼Ÿ" class="headerlink" title="3 å¦‚ä½•å†™å‡ºæ»¡è¶³ KISS åŸåˆ™çš„ä»£ç ï¼Ÿ"></a>3 å¦‚ä½•å†™å‡ºæ»¡è¶³ KISS åŸåˆ™çš„ä»£ç ï¼Ÿ</h2><ul>
<li>ä¸è¦ä½¿ç”¨åŒäº‹å¯èƒ½ä¸æ‡‚çš„æŠ€æœ¯æ¥å®ç°ä»£ç ã€‚æ¯”å¦‚å‰é¢ä¾‹å­ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿˜æœ‰ä¸€äº›ç¼–ç¨‹è¯­è¨€ä¸­è¿‡äºé«˜çº§çš„è¯­æ³•ç­‰ã€‚</li>
<li>ä¸è¦é‡å¤é€ è½®å­ï¼Œè¦å–„äºä½¿ç”¨å·²ç»æœ‰çš„å·¥å…·ç±»åº“ã€‚ç»éªŒè¯æ˜ï¼Œè‡ªå·±å»å®ç°è¿™äº›ç±»åº“ï¼Œå‡º <code>bug</code> çš„æ¦‚ç‡ä¼šæ›´é«˜ï¼Œç»´æŠ¤çš„æˆæœ¬ä¹Ÿæ¯”è¾ƒé«˜ã€‚</li>
<li>ä¸è¦è¿‡åº¦ä¼˜åŒ–ã€‚ä¸è¦è¿‡åº¦ä½¿ç”¨ä¸€äº›å¥‡æŠ€æ·«å·§ï¼ˆæ¯”å¦‚ï¼Œä½è¿ç®—ä»£æ›¿ç®—æœ¯è¿ç®—ã€å¤æ‚çš„æ¡ä»¶è¯­å¥ä»£æ›¿ <code>if-else</code>ã€ä½¿ç”¨ä¸€äº›è¿‡äºåº•å±‚çš„å‡½æ•°ç­‰ï¼‰æ¥ä¼˜åŒ–ä»£ç ï¼Œç‰ºç‰²ä»£ç çš„å¯è¯»æ€§ã€‚</li>
</ul>
<p>è¯„åˆ¤ä»£ç æ˜¯å¦ç®€å•ï¼Œæœ‰ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„é—´æ¥æ–¹æ³•ï¼Œé‚£å°±æ˜¯ <code>code review</code>ã€‚å¦‚æœåœ¨ <code>code review</code> çš„æ—¶å€™ï¼ŒåŒäº‹å¯¹ä½ çš„ä»£ç æœ‰å¾ˆå¤šç–‘é—®ï¼Œé‚£å°±è¯´æ˜ä½ çš„ä»£ç æœ‰å¯èƒ½ä¸å¤Ÿ â€œç®€å•â€ ï¼Œéœ€è¦ä¼˜åŒ–å•¦ã€‚</p>
<p>æˆ‘ä»¬åœ¨åšå¼€å‘çš„æ—¶å€™ï¼Œä¸€å®šä¸è¦è¿‡åº¦è®¾è®¡ï¼Œä¸è¦è§‰å¾—ç®€å•çš„ä¸œè¥¿å°±æ²¡æœ‰æŠ€æœ¯å«é‡ã€‚å®é™…ä¸Šï¼Œè¶Šæ˜¯èƒ½ç”¨ç®€å•çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œè¶Šèƒ½ä½“ç°ä¸€ä¸ªäººçš„èƒ½åŠ›ã€‚</p>
<h2 id="4-YAGNI-åŸåˆ™è·Ÿ-KISS-åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ"><a href="#4-YAGNI-åŸåˆ™è·Ÿ-KISS-åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ" class="headerlink" title="4 YAGNI åŸåˆ™è·Ÿ KISS åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ"></a>4 YAGNI åŸåˆ™è·Ÿ KISS åŸåˆ™è¯´çš„æ˜¯ä¸€å›äº‹å—ï¼Ÿ</h2><p><code>You Ainâ€™t Gonna Need It(ä½ ä¸ä¼šéœ€è¦å®ƒ)</code> </p>
<p>ä¸è¦å»è®¾è®¡å½“å‰ç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼›ä¸è¦å»ç¼–å†™å½“å‰ç”¨ä¸åˆ°çš„ä»£ç ã€‚å®é™…ä¸Šï¼Œè¿™æ¡åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šä¸è¦åšè¿‡åº¦è®¾è®¡ã€‚</p>
<p>å¯¹äº <code>Java</code> ç¨‹åºå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ <code>Maven</code> æˆ–è€… <code>Gradle</code> æ¥ç®¡ç†ä¾èµ–çš„ç±»åº“ï¼ˆ<code>library</code>ï¼‰ï¼Œæœ‰äº›åŒäº‹ä¸ºäº†é¿å…å¼€å‘ä¸­ <code>library</code> åŒ…ç¼ºå¤±è€Œé¢‘ç¹åœ°ä¿®æ”¹ <code>Maven</code> æˆ–è€… <code>Gradle</code> é…ç½®æ–‡ä»¶ï¼Œæå‰å¾€é¡¹ç›®é‡Œå¼•å…¥å¤§é‡å¸¸ç”¨çš„ <code>library</code> åŒ…ã€‚å®é™…ä¸Šï¼Œè¿™æ ·çš„åšæ³•ä¹Ÿæ˜¯è¿èƒŒ YAGNI åŸåˆ™çš„ã€‚</p>
<p><code>KISS</code> åŸåˆ™è®²çš„æ˜¯ â€œå¦‚ä½•åšâ€ çš„é—®é¢˜ï¼ˆå°½é‡ä¿æŒç®€å•ï¼‰ï¼Œè€Œ <code>YAGNI</code> åŸåˆ™è¯´çš„æ˜¯ â€œè¦ä¸è¦åšâ€ çš„é—®é¢˜ï¼ˆå½“å‰ä¸éœ€è¦çš„å°±ä¸è¦åšï¼‰ã€‚</p>
<hr>
<h1 id="ğŸš©DRY-åŸåˆ™"><a href="#ğŸš©DRY-åŸåˆ™" class="headerlink" title="ğŸš©DRY åŸåˆ™"></a>ğŸš©DRY åŸåˆ™</h1><p><code>Donâ€™t Repeat Yourself(ä¸è¦é‡å¤è‡ªå·±)</code> </p>
<p>å¯ä»¥ç†è§£ä¸ºï¼šä¸è¦å†™é‡å¤çš„ä»£ç ã€‚</p>
<p>ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œè¿™æ¡åŸåˆ™éå¸¸ç®€å•ã€éå¸¸å®¹æ˜“åº”ç”¨ã€‚åªè¦ä¸¤æ®µä»£ç é•¿å¾—ä¸€æ ·ï¼Œé‚£å°±æ˜¯è¿å <code>DRY</code> åŸåˆ™äº†ã€‚çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ<br>ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è¿™æ˜¯å¾ˆå¤šäººå¯¹è¿™æ¡åŸåˆ™å­˜åœ¨çš„è¯¯è§£ã€‚å®é™…ä¸Šï¼Œé‡å¤çš„ä»£ç ä¸ä¸€å®šè¿å <code>DRY</code> åŸåˆ™ï¼Œè€Œä¸”æœ‰äº›çœ‹ä¼¼ä¸é‡å¤çš„ä»£ç ä¹Ÿæœ‰å¯èƒ½è¿å <code>DRY</code> åŸåˆ™ã€‚</p>
<h2 id="1-å®ç°é€»è¾‘é‡å¤"><a href="#1-å®ç°é€»è¾‘é‡å¤" class="headerlink" title="1 å®ç°é€»è¾‘é‡å¤"></a>1 å®ç°é€»è¾‘é‡å¤</h2><p>ä¸¾ä¸ªæ —å­ğŸŒ° æœ‰ä¸¤å¤„éå¸¸æ˜æ˜¾çš„é‡å¤çš„ä»£ç ç‰‡æ®µï¼š<code>isValidUserName()</code> å‡½æ•°å’Œ <code>isValidPassword()</code> å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAuthenticator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authenticate</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isValidUsername(username)) &#123;</span><br><span class="line">      <span class="comment">// ...throw InvalidUsernameException...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isValidPassword(password)) &#123;</span><br><span class="line">      <span class="comment">// ...throw InvalidPasswordException...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// check not null, not empty</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(username)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check length: 4~64</span></span><br><span class="line">    <span class="keyword">int</span> length = username.length();</span><br><span class="line">    <span class="keyword">if</span> (length &lt; <span class="number">4</span> || length &gt; <span class="number">64</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// contains only lowcase characters</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isAllLowerCase(username)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// contains only a~z,0~9,dot</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">      <span class="keyword">char</span> c = username.charAt(i);</span><br><span class="line">      <span class="keyword">if</span> (!(c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) || (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) || c == <span class="string">'.'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// check not null, not empty</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(password)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check length: 4~64</span></span><br><span class="line">    <span class="keyword">int</span> length = password.length();</span><br><span class="line">    <span class="keyword">if</span> (length &lt; <span class="number">4</span> || length &gt; <span class="number">64</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// contains only lowcase characters</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isAllLowerCase(password)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// contains only a~z,0~9,dot</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">      <span class="keyword">char</span> c = password.charAt(i);</span><br><span class="line">      <span class="keyword">if</span> (!(c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) || (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) || c == <span class="string">'.'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¤çš„ä»£ç è¢«æ•²äº†ä¸¤éï¼Œæˆ–è€…ç®€å• <code>copy-paste</code> äº†ä¸€ä¸‹ï¼Œçœ‹èµ·æ¥æ˜æ˜¾è¿å <code>DRY</code> åŸåˆ™ã€‚ä¸ºäº†ç§»é™¤é‡å¤çš„ä»£ç ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç åšä¸‹é‡æ„ï¼Œå°† <code>isValidUserName()</code> å‡½æ•°å’Œ <code>isValidPassword()</code> å‡½æ•°ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªæ›´é€šç”¨çš„å‡½æ•° <code>isValidUserNameOrPassword()</code> ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAuthenticatorV2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">authenticate</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isValidUsernameOrPassword(userName)) &#123;</span><br><span class="line">      <span class="comment">// ...throw InvalidUsernameException...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isValidUsernameOrPassword(password)) &#123;</span><br><span class="line">      <span class="comment">// ...throw InvalidPasswordException...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidUsernameOrPassword</span><span class="params">(String usernameOrPassword)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//çœç•¥å®ç°é€»è¾‘</span></span><br><span class="line">    <span class="comment">//è·ŸåŸæ¥çš„isValidUsername()æˆ–isValidPassword()çš„å®ç°é€»è¾‘ä¸€æ ·...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡é‡æ„ä¹‹åï¼Œä»£ç è¡Œæ•°å‡å°‘äº†ï¼Œä¹Ÿæ²¡æœ‰é‡å¤çš„ä»£ç äº†ï¼Œæ˜¯ä¸æ˜¯æ›´å¥½äº†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ï¼</p>
<p>åˆå¹¶ä¹‹åçš„ <code>isValidUserNameOrPassword()</code> å‡½æ•°ï¼Œè´Ÿè´£ä¸¤ä»¶äº‹æƒ…ï¼šéªŒè¯ç”¨æˆ·åå’ŒéªŒè¯å¯†ç ï¼Œè¿åäº† â€œå•ä¸€èŒè´£åŸåˆ™â€ å’Œ â€œæ¥å£éš”ç¦»åŸåˆ™â€ ã€‚</p>
<p>ä»ä»£ç å®ç°é€»è¾‘ä¸Šçœ‹èµ·æ¥æ˜¯é‡å¤çš„ï¼Œä½†æ˜¯ä»è¯­ä¹‰ä¸Šå¹¶ä¸é‡å¤ã€‚æ‰€è°“ â€œè¯­ä¹‰ä¸é‡å¤â€ æŒ‡çš„æ˜¯ï¼šä»åŠŸèƒ½ä¸Šæ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¹²çš„æ˜¯å®Œå…¨ä¸é‡å¤çš„ä¸¤ä»¶äº‹æƒ…ï¼Œä¸€ä¸ªæ˜¯æ ¡éªŒç”¨æˆ·åï¼Œå¦ä¸€ä¸ªæ˜¯æ ¡éªŒå¯†ç ã€‚<br>ç»è¿‡é‡æ„ä¹‹åï¼Œåœ¨æœªæ¥çš„æŸä¸€å¤©ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†å¯†ç çš„æ ¡éªŒé€»è¾‘ï¼Œæˆ‘ä»¬å°±è¦æŠŠåˆå¹¶åçš„å‡½æ•°ï¼Œé‡æ–°æ‹†æˆåˆå¹¶å‰çš„é‚£ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<p>å°½ç®¡ä»£ç çš„å®ç°é€»è¾‘æ˜¯ç›¸åŒçš„ï¼Œä½†è¯­ä¹‰ä¸åŒï¼Œæˆ‘ä»¬åˆ¤å®šå®ƒå¹¶ä¸è¿å <code>DRY</code> åŸåˆ™ã€‚å¯¹äºåŒ…å«é‡å¤ä»£ç çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ½è±¡æˆæ›´ç»†ç²’åº¦å‡½æ•°çš„æ–¹å¼æ¥è§£å†³ã€‚</p>
<h2 id="2-åŠŸèƒ½è¯­ä¹‰é‡å¤"><a href="#2-åŠŸèƒ½è¯­ä¹‰é‡å¤" class="headerlink" title="2 åŠŸèƒ½è¯­ä¹‰é‡å¤"></a>2 åŠŸèƒ½è¯­ä¹‰é‡å¤</h2><p>åœ¨åŒä¸€ä¸ªé¡¹ç›®ä»£ç ä¸­æœ‰ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ï¼š<code>isValidIp()</code> å’Œ <code>checkIfIpValid()</code>ã€‚å°½ç®¡ä¸¤ä¸ªå‡½æ•°çš„å‘½åä¸åŒï¼Œå®ç°é€»è¾‘ä¸åŒï¼Œä½†åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ç”¨æ¥åˆ¤å®š <code>IP</code>åœ°å€æ˜¯å¦åˆæ³•çš„ã€‚</p>
<p>ä¹‹æ‰€ä»¥åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä¼šæœ‰ä¸¤ä¸ªåŠŸèƒ½ç›¸åŒçš„å‡½æ•°ï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç”±ä¸¤ä¸ªä¸åŒçš„åŒäº‹å¼€å‘çš„ï¼Œè¿™æ—¶ç»å¸¸é‡åˆ°çš„ï¼Œå…¶ä¸­ä¸€ä¸ªåŒäº‹åœ¨ä¸çŸ¥é“å·²ç»å­˜åœ¨ç›¸åŒåŠŸèƒ½çš„æƒ…å†µä¸‹åˆå†™äº†ä¸€ä¸ªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidIp</span><span class="params">(String ipAddress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  String regex = <span class="string">"^(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."</span></span><br><span class="line">          + <span class="string">"(1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$"</span>;</span><br><span class="line">  <span class="keyword">return</span> ipAddress.matches(regex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkIfIpValid</span><span class="params">(String ipAddress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.isBlank(ipAddress)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  String[] ipUnits = StringUtils.split(ipAddress, <span class="string">'.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (ipUnits.length != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> ipUnitIntValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ipUnitIntValue = Integer.parseInt(ipUnits[i]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ipUnitIntValue &lt; <span class="number">0</span> || ipUnitIntValue &gt; <span class="number">255</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; ipUnitIntValue == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°½ç®¡ä¸¤æ®µä»£ç çš„å®ç°é€»è¾‘ä¸é‡å¤ï¼Œä½†è¯­ä¹‰é‡å¤ï¼Œä¹Ÿå°±æ˜¯åŠŸèƒ½é‡å¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒè¿åäº† DRY åŸåˆ™ã€‚æˆ‘ä»¬åº”è¯¥åœ¨é¡¹ç›®ä¸­ï¼Œç»Ÿä¸€ä¸€ç§å®ç°æ€è·¯ï¼Œæ‰€æœ‰ç”¨åˆ°åˆ¤æ–­ <code>IP</code> åœ°å€æ˜¯å¦åˆæ³•çš„åœ°æ–¹ï¼Œéƒ½ç»Ÿä¸€è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ä¸ç»Ÿä¸€å®ç°æ€è·¯ï¼Œç»™ä¸ç†Ÿæ‚‰è¿™éƒ¨åˆ†ä»£ç çš„åŒäº‹å¢åŠ äº†é˜…è¯»çš„éš¾åº¦ã€‚åŒäº‹æœ‰å¯èƒ½ç ”ç©¶äº†åŠå¤©ï¼Œè§‰å¾—åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†åˆæœ‰ç‚¹ç–‘æƒ‘ï¼Œè§‰å¾—æ˜¯ä¸æ˜¯æœ‰æ›´é«˜æ·±çš„è€ƒé‡ï¼Œæ‰å®šä¹‰äº†ä¸¤ä¸ªåŠŸèƒ½ç±»ä¼¼çš„å‡½æ•°ï¼Œæœ€ç»ˆå‘ç°å±…ç„¶æ˜¯ä»£ç è®¾è®¡çš„é—®é¢˜ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå“ªå¤©é¡¹ç›®ä¸­ <code>IP</code> åœ°å€æ˜¯å¦åˆæ³•çš„åˆ¤å®šè§„åˆ™æ”¹å˜äº†ï¼Œç›¸åº”åœ°ï¼Œæˆ‘ä»¬å¯¹ <code>isValidIp()</code> çš„å®ç°é€»è¾‘åšäº†ç›¸åº”çš„ä¿®æ”¹ï¼Œä½†å´å¿˜è®°äº†ä¿®æ”¹ <code>checkIfIpValid()</code> å‡½æ•°ã€‚åˆæˆ–è€…ï¼Œæˆ‘ä»¬å‹æ ¹å°±ä¸çŸ¥é“è¿˜å­˜åœ¨ä¸€ä¸ªåŠŸèƒ½ç›¸åŒçš„ <code>checkIfIpValid()</code> å‡½æ•°ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœ‰äº›ä»£ç ä»ç„¶ä½¿ç”¨è€çš„ <code>IP</code> åœ°å€åˆ¤æ–­é€»è¾‘ï¼Œå¯¼è‡´å‡ºç°ä¸€äº›è«åå…¶å¦™çš„ <code>bug</code>ã€‚</p>
<h2 id="3-ä»£ç æ‰§è¡Œé‡å¤"><a href="#3-ä»£ç æ‰§è¡Œé‡å¤" class="headerlink" title="3 ä»£ç æ‰§è¡Œé‡å¤"></a>3 ä»£ç æ‰§è¡Œé‡å¤</h2><p>ç¬¬ä¸‰ä¸ªæ —å­ğŸŒ° <code>UserService</code> ä¸­ <code>login()</code> å‡½æ•°ç”¨æ¥æ ¡éªŒç”¨æˆ·ç™»å½•æ˜¯å¦æˆåŠŸã€‚å¦‚æœå¤±è´¥ï¼Œå°±è¿”å›å¼‚å¸¸ï¼›å¦‚æœæˆåŠŸï¼Œå°±è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> UserRepo userRepo;<span class="comment">//é€šè¿‡ä¾èµ–æ³¨å…¥æˆ–è€…IOCæ¡†æ¶æ³¨å…¥</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String email, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> existed = userRepo.checkIfUserExisted(email, password);</span><br><span class="line">    <span class="keyword">if</span> (!existed) &#123;<span class="comment">/*...throw AuthenticationFailureException...*/</span>&#125;</span><br><span class="line">    User user = userRepo.getUserByEmail(email);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkIfUserExisted</span><span class="params">(String email, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!EmailValidation.validate(email)) &#123;<span class="comment">/*...throw InvalidEmailException...*/</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> (!PasswordValidation.validate(password)) &#123;<span class="comment">/*...throw InvalidPasswordException...*/</span>&#125;</span><br><span class="line">    <span class="comment">//...query db to check if email&amp;password exists...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">getUserByEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!EmailValidation.validate(email)) &#123;<span class="comment">/*...throw InvalidEmailException...*/</span>&#125;</span><br><span class="line">    <span class="comment">//...query db to get user by email...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œæ—¢æ²¡æœ‰é€»è¾‘é‡å¤ï¼Œä¹Ÿæ²¡æœ‰è¯­ä¹‰é‡å¤ï¼Œä½†ä»ç„¶è¿åäº† <code>DRY</code> åŸåˆ™ã€‚è¿™æ˜¯å› ä¸ºä»£ç ä¸­å­˜åœ¨ â€œæ‰§è¡Œé‡å¤â€ ã€‚</p>
<p><code>email</code> çš„æ ¡éªŒé€»è¾‘è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚ä¸€æ¬¡æ˜¯åœ¨è°ƒç”¨ <code>checkIfUserExisted()</code> å‡½æ•°çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯è°ƒç”¨ <code>getUserByEmail()</code> å‡½æ•°çš„æ—¶å€™ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ ¡éªŒé€»è¾‘ä» <code>UserRepo</code> ä¸­ç§»é™¤ï¼Œç»Ÿä¸€æ”¾åˆ° <code>UserService</code> ä¸­å°±å¯ä»¥äº†ã€‚</p>
<p>ä»£ç ä¸­è¿˜æœ‰ä¸€å¤„æ¯”è¾ƒéšè”½çš„æ‰§è¡Œé‡å¤ï¼Œ<code>login()</code> å‡½æ•°å¹¶ä¸éœ€è¦è°ƒç”¨ <code>checkIfUserExisted()</code> å‡½æ•°ï¼Œåªéœ€è¦è°ƒç”¨ä¸€æ¬¡ <code>getUserByEmail()</code> å‡½æ•°ï¼Œä»æ•°æ®åº“ä¸­è·å–åˆ°ç”¨æˆ·çš„ <code>email</code>ã€<code>password</code> ç­‰ä¿¡æ¯ï¼Œç„¶åè·Ÿç”¨æˆ·è¾“å…¥çš„ <code>email</code>ã€<code>password</code> ä¿¡æ¯åšå¯¹æ¯”ï¼Œä¾æ¬¡åˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸã€‚</p>
<p>è¿™æ ·çš„ä¼˜åŒ–æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å› ä¸º <code>checkIfUserExisted()</code> å‡½æ•°å’Œ <code>getUserByEmail()</code> å‡½æ•°éƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œæ•°æ®åº“è¿™ç±»çš„ <code>I/O</code> æ“ä½œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œåº”å½“å°½é‡å‡å°‘è¿™ç±» <code>I/O</code> æ“ä½œã€‚</p>
<p>æŒ‰ç…§åˆšåˆšçš„ä¿®æ”¹æ€è·¯ï¼Œæˆ‘ä»¬æŠŠä»£ç é‡æ„ä¸€ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> UserRepo userRepo;<span class="comment">//é€šè¿‡ä¾èµ–æ³¨å…¥æˆ–è€…IOCæ¡†æ¶æ³¨å…¥</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String email, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!EmailValidation.validate(email)) &#123;<span class="comment">/*...throw InvalidEmailException...*/</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> (!PasswordValidation.validate(password)) &#123;<span class="comment">/*...throw InvalidPasswordException...*/</span>&#125;</span><br><span class="line"></span><br><span class="line">    User user = userRepo.getUserByEmail(email);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span> || !password.equals(user.getPassword())  &#123;<span class="comment">/*...throw AuthenticationFailureException...*/</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">getUserByEmail</span><span class="params">(String email)</span> </span>&#123;<span class="comment">/*...query db to get user by email...*/</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ"><a href="#4-æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ" class="headerlink" title="4 æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ"></a>4 æ€ä¹ˆæé«˜ä»£ç å¤ç”¨æ€§ï¼Ÿ</h2><ul>
<li><p>å‡å°‘ä»£ç è€¦åˆ</p>
<p>å¯¹äºé«˜åº¦è€¦åˆçš„ä»£ç ï¼Œå½“æˆ‘ä»¬å¸Œæœ›å¤ç”¨å…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæƒ³æŠŠè¿™ä¸ªåŠŸèƒ½çš„ä»£ç æŠ½å–å‡ºæ¥æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€ç±»æˆ–è€…å‡½æ•°çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‘ç°ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚ç§»åŠ¨ä¸€ç‚¹ä»£ç ï¼Œå°±è¦ç‰µè¿åˆ°å¾ˆå¤šå…¶ä»–ç›¸å…³çš„ä»£ç ã€‚æ‰€ä»¥ï¼Œé«˜åº¦è€¦åˆçš„ä»£ç ä¼šå½±å“åˆ°ä»£ç çš„å¤ç”¨æ€§ï¼Œæˆ‘ä»¬è¦å°½é‡å‡å°‘ä»£ç è€¦åˆã€‚</p>
</li>
<li><p>æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™</p>
<p>å¦‚æœèŒè´£ä¸å¤Ÿå•ä¸€ï¼Œæ¨¡å—ã€ç±»è®¾è®¡å¾—å¤§è€Œå…¨ï¼Œé‚£ä¾èµ–å®ƒçš„ä»£ç æˆ–è€…å®ƒä¾èµ–çš„ä»£ç å°±ä¼šæ¯”è¾ƒå¤šï¼Œè¿›è€Œå¢åŠ äº†ä»£ç çš„è€¦åˆã€‚æ ¹æ®ä¸Šä¸€ç‚¹ï¼Œä¹Ÿå°±ä¼šå½±å“åˆ°ä»£ç çš„å¤ç”¨æ€§ã€‚ç›¸åï¼Œè¶Šç»†ç²’åº¦çš„ä»£ç ï¼Œä»£ç çš„é€šç”¨æ€§ä¼šè¶Šå¥½ï¼Œè¶Šå®¹æ˜“è¢«å¤ç”¨ã€‚</p>
</li>
<li><p>æ¨¡å—åŒ–</p>
<p>è¿™é‡Œçš„ â€œæ¨¡å—â€ ï¼Œä¸å•å•æŒ‡ä¸€ç»„ç±»æ„æˆçš„æ¨¡å—ï¼Œè¿˜å¯ä»¥ç†è§£ä¸ºå•ä¸ªç±»ã€å‡½æ•°ã€‚æˆ‘ä»¬è¦å–„äºå°†åŠŸèƒ½ç‹¬ç«‹çš„ä»£ç ï¼Œå°è£…æˆæ¨¡å—ã€‚ç‹¬ç«‹çš„æ¨¡å—å°±åƒä¸€å—ä¸€å—çš„ç§¯æœ¨ï¼Œæ›´åŠ å®¹æ˜“å¤ç”¨ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥æ­å»ºæ›´åŠ å¤æ‚çš„ç³»ç»Ÿã€‚</p>
</li>
<li><p>ä¸šåŠ¡ä¸éä¸šåŠ¡é€»è¾‘åˆ†ç¦»</p>
<p>è¶Šæ˜¯è·Ÿä¸šåŠ¡æ— å…³çš„ä»£ç è¶Šæ˜¯å®¹æ˜“å¤ç”¨ï¼Œè¶Šæ˜¯é’ˆå¯¹ç‰¹å®šä¸šåŠ¡çš„ä»£ç è¶Šéš¾å¤ç”¨ã€‚æ‰€ä»¥ï¼Œä¸ºäº†å¤ç”¨è·Ÿä¸šåŠ¡æ— å…³çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ä¸šåŠ¡å’Œéä¸šåŠ¡é€»è¾‘ä»£ç åˆ†ç¦»ï¼ŒæŠ½å–æˆä¸€äº›é€šç”¨çš„æ¡†æ¶ã€ç±»åº“ã€ç»„ä»¶ç­‰ã€‚</p>
</li>
<li><p>é€šç”¨ä»£ç ä¸‹æ²‰</p>
<p>ä»åˆ†å±‚çš„è§’åº¦æ¥çœ‹ï¼Œè¶Šåº•å±‚çš„ä»£ç è¶Šé€šç”¨ã€ä¼šè¢«è¶Šå¤šçš„æ¨¡å—è°ƒç”¨ï¼Œè¶Šåº”è¯¥è®¾è®¡å¾—è¶³å¤Ÿå¯å¤ç”¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ä»£ç åˆ†å±‚ä¹‹åï¼Œä¸ºäº†é¿å…äº¤å‰è°ƒç”¨å¯¼è‡´è°ƒç”¨å…³ç³»æ··ä¹±ï¼Œæˆ‘ä»¬åªå…è®¸ä¸Šå±‚ä»£ç è°ƒç”¨ä¸‹å±‚ä»£ç åŠåŒå±‚ä»£ç ä¹‹é—´çš„è°ƒç”¨ï¼Œæœç»ä¸‹å±‚ä»£ç è°ƒç”¨ä¸Šå±‚ä»£ç ã€‚æ‰€ä»¥ï¼Œé€šç”¨çš„ä»£ç æˆ‘ä»¬å°½é‡ä¸‹æ²‰åˆ°æ›´ä¸‹å±‚ã€‚</p>
</li>
<li><p>ç»§æ‰¿ã€å¤šæ€ã€æŠ½è±¡ã€å°è£…</p>
<p>åˆ©ç”¨ç»§æ‰¿ï¼Œå¯ä»¥å°†å…¬å…±çš„ä»£ç æŠ½å–åˆ°çˆ¶ç±»ï¼Œå­ç±»å¤ç”¨çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚åˆ©ç”¨å¤šæ€ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°æ›¿æ¢ä¸€æ®µä»£ç çš„éƒ¨åˆ†é€»è¾‘ï¼Œè®©è¿™æ®µä»£ç å¯å¤ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒæŠ½è±¡å’Œå°è£…ï¼Œä»æ›´åŠ å¹¿ä¹‰çš„å±‚é¢ã€è€Œéç‹­ä¹‰çš„é¢å‘å¯¹è±¡ç‰¹æ€§çš„å±‚é¢æ¥ç†è§£çš„è¯ï¼Œè¶ŠæŠ½è±¡ã€è¶Šä¸ä¾èµ–å…·ä½“çš„å®ç°ï¼Œè¶Šå®¹æ˜“å¤ç”¨ã€‚ä»£ç å°è£…æˆæ¨¡å—ï¼Œéšè—å¯å˜çš„ç»†èŠ‚ã€æš´éœ²ä¸å˜çš„æ¥å£ï¼Œå°±è¶Šå®¹æ˜“å¤ç”¨ã€‚</p>
</li>
<li><p>åº”ç”¨æ¨¡æ¿ç­‰è®¾è®¡æ¨¡å¼</p>
<p>ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿèƒ½æé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚æ¯”å¦‚ï¼Œæ¨¡æ¿æ¨¡å¼åˆ©ç”¨äº†å¤šæ€æ¥å®ç°ï¼Œå¯ä»¥çµæ´»åœ°æ›¿æ¢å…¶ä¸­çš„éƒ¨åˆ†ä»£ç ï¼Œæ•´ä¸ªæµç¨‹æ¨¡æ¿ä»£ç å¯å¤ç”¨ã€‚</p>
</li>
</ul>
<h2 id="5-è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨"><a href="#5-è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨" class="headerlink" title="5 è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨"></a>5 è¾©è¯æ€è€ƒå’Œçµæ´»åº”ç”¨</h2><p>å®é™…ä¸Šï¼Œç¼–å†™å¯å¤ç”¨çš„ä»£ç å¹¶ä¸ç®€å•ã€‚<br>é™¤éæœ‰éå¸¸æ˜ç¡®çš„å¤ç”¨éœ€æ±‚ï¼Œå¦åˆ™ï¼Œä¸ºäº†æš‚æ—¶ç”¨ä¸åˆ°çš„å¤ç”¨éœ€æ±‚ï¼ŒèŠ±è´¹å¤ªå¤šçš„æ—¶é—´ã€ç²¾åŠ›ï¼ŒæŠ•å…¥å¤ªå¤šçš„å¼€å‘æˆæœ¬ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå€¼å¾—æ¨èçš„åšæ³•ã€‚è¿™ä¹Ÿè¿åæˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„ <code>YAGNI</code> åŸåˆ™ã€‚</p>
<p>æœ‰ä¸€ä¸ªè‘—åçš„åŸåˆ™ï¼Œå«ä½œ <code>â€œRule of Threeâ€</code> ã€‚è¿™æ¡åŸåˆ™å¯ä»¥ç”¨åœ¨å¾ˆå¤šè¡Œä¸šå’Œåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡å†™ä»£ç çš„æ—¶å€™ï¼Œå¦‚æœå½“ä¸‹æ²¡æœ‰å¤ç”¨çš„éœ€æ±‚ï¼Œè€Œæœªæ¥çš„å¤ç”¨éœ€æ±‚ä¹Ÿä¸æ˜¯ç‰¹åˆ«æ˜ç¡®ï¼Œå¹¶ä¸”å¼€å‘å¯å¤ç”¨ä»£ç çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦è€ƒè™‘ä»£ç çš„å¤ç”¨æ€§ã€‚<br>åœ¨ä¹‹åæˆ‘ä»¬å¼€å‘æ–°çš„åŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç°å¯ä»¥å¤ç”¨ä¹‹å‰å†™çš„è¿™æ®µä»£ç ï¼Œé‚£æˆ‘ä»¬å°±é‡æ„è¿™æ®µä»£ç ï¼Œè®©å…¶å˜å¾—æ›´åŠ å¯å¤ç”¨ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€æ¬¡ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘å¤ç”¨æ€§ï¼›ç¬¬äºŒæ¬¡é‡åˆ°å¤ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œå†è¿›è¡Œé‡æ„ä½¿å…¶å¤ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>â€œRule of Threeâ€</code> ä¸­çš„ <code>â€œThreeâ€</code> å¹¶ä¸æ˜¯çœŸçš„å°±æŒ‡ç¡®åˆ‡çš„ <code>â€œä¸‰â€</code> ã€‚</p>
<hr>
<h1 id="ğŸš©è¿ªç±³ç‰¹æ³•åˆ™"><a href="#ğŸš©è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="ğŸš©è¿ªç±³ç‰¹æ³•åˆ™"></a>ğŸš©è¿ªç±³ç‰¹æ³•åˆ™</h1><p><code>Law of Demeter LOD</code></p>
<p><code>Each unit should have only limited knowledge about other units: only units â€œcloselyâ€ related to the current unit. Or: Each unit should only talk to its friends; Donâ€™t talk to strangers.(æ¯ä¸ªæ¨¡å—ï¼ˆunitï¼‰åªåº”è¯¥äº†è§£é‚£äº›ä¸å®ƒå…³ç³»å¯†åˆ‡çš„æ¨¡å—ï¼ˆunits: only units â€œcloselyâ€ related to the current unitï¼‰çš„æœ‰é™çŸ¥è¯†ï¼ˆknowledgeï¼‰ã€‚æˆ–è€…è¯´ï¼Œæ¯ä¸ªæ¨¡å—åªå’Œè‡ªå·±çš„æœ‹å‹â€œè¯´è¯â€ï¼ˆtalkï¼‰ï¼Œä¸å’Œé™Œç”Ÿäººâ€œè¯´è¯â€ï¼ˆtalkï¼‰ã€‚)</code></p>
<p><code>ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–ï¼›æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£ï¼ˆä¹Ÿå°±æ˜¯å®šä¹‰ä¸­çš„â€œæœ‰é™çŸ¥è¯†â€ï¼‰ã€‚</code></p>
<p>è¿ªç±³ç‰¹æ³•åˆ™ã€‚å°½ç®¡å®ƒä¸åƒ <code>SOLID</code>ã€<code>KISS</code>ã€<code>DRY</code> åŸåˆ™é‚£æ ·ï¼Œäººå°½çš†çŸ¥ï¼Œä½†å®ƒå´éå¸¸å®ç”¨ã€‚åˆ©ç”¨è¿™ä¸ªåŸåˆ™ï¼Œèƒ½å¤Ÿå¸®æˆ‘ä»¬å®ç°ä»£ç çš„ â€œé«˜å†…èšã€æ¾è€¦åˆâ€ ã€‚</p>
<h2 id="1-ä½•ä¸º-â€œé«˜å†…èšã€æ¾è€¦åˆâ€-ï¼Ÿ"><a href="#1-ä½•ä¸º-â€œé«˜å†…èšã€æ¾è€¦åˆâ€-ï¼Ÿ" class="headerlink" title="1 ä½•ä¸º â€œé«˜å†…èšã€æ¾è€¦åˆâ€ ï¼Ÿ"></a>1 ä½•ä¸º â€œé«˜å†…èšã€æ¾è€¦åˆâ€ ï¼Ÿ</h2><p>åœ¨è¿™ä¸ªè®¾è®¡æ€æƒ³ä¸­ï¼Œâ€œé«˜å†…èšâ€ ç”¨æ¥æŒ‡å¯¼ç±»æœ¬èº«çš„è®¾è®¡ï¼Œâ€œæ¾è€¦åˆâ€ ç”¨æ¥æŒ‡å¯¼ç±»ä¸ç±»ä¹‹é—´ä¾èµ–å…³ç³»çš„è®¾è®¡ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤è€…å¹¶éå®Œå…¨ç‹¬ç«‹ä¸ç›¸å¹²ã€‚é«˜å†…èšæœ‰åŠ©äºæ¾è€¦åˆï¼Œæ¾è€¦åˆåˆéœ€è¦é«˜å†…èšçš„æ”¯æŒã€‚</p>
<ul>
<li><p>æ‰€è°“é«˜å†…èšï¼Œå°±æ˜¯æŒ‡ç›¸è¿‘çš„åŠŸèƒ½åº”è¯¥æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸ç›¸è¿‘çš„åŠŸèƒ½ä¸è¦æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ã€‚</p>
<p>ç›¸è¿‘çš„åŠŸèƒ½å¾€å¾€ä¼šè¢«åŒæ—¶ä¿®æ”¹ï¼Œæ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¿®æ”¹ä¼šæ¯”è¾ƒé›†ä¸­ï¼Œä»£ç å®¹æ˜“ç»´æŠ¤ã€‚å®é™…ä¸Šï¼Œå•ä¸€èŒè´£åŸåˆ™æ˜¯å®ç°ä»£ç é«˜å†…èšéå¸¸æœ‰æ•ˆçš„è®¾è®¡åŸåˆ™ã€‚</p>
</li>
<li><p>æ‰€è°“æ¾è€¦åˆæ˜¯è¯´ï¼Œåœ¨ä»£ç ä¸­ï¼Œç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ¸…æ™°ã€‚</p>
<p>å³ä½¿ä¸¤ä¸ªç±»æœ‰ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªç±»çš„ä»£ç æ”¹åŠ¨ä¸ä¼šæˆ–è€…å¾ˆå°‘å¯¼è‡´ä¾èµ–ç±»çš„ä»£ç æ”¹åŠ¨ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å‰é¢è®²çš„ä¾èµ–æ³¨å…¥ã€æ¥å£éš”ç¦»ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»¥åŠè¿ªç±³ç‰¹æ³•åˆ™ï¼Œéƒ½æ˜¯ä¸ºäº†å®ç°ä»£ç çš„æ¾è€¦åˆã€‚</p>
</li>
</ul>
<p>##2 ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–</p>
<p>è¿ªç±³ç‰¹æ³•åˆ™çš„å‰åŠéƒ¨åˆ†ï¼Œ</p>
<h2 id="2-ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–"><a href="#2-ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–" class="headerlink" title="2 ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–"></a>2 ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–</h2><p>ä¸¾ä¸ªæ —å­ğŸŒ° ä»£ç ä¸­åŒ…å«ä¸‰ä¸ªä¸»è¦çš„ç±»ã€‚å…¶ä¸­ï¼Œ<code>NetworkTransporter</code> ç±»è´Ÿè´£åº•å±‚ç½‘ç»œé€šä¿¡ï¼Œæ ¹æ®è¯·æ±‚è·å–æ•°æ®ï¼›<code>HtmlDownloader</code> ç±»ç”¨æ¥é€šè¿‡ <code>URL</code> è·å–ç½‘é¡µï¼›<code>Document</code> è¡¨ç¤ºç½‘é¡µæ–‡æ¡£ï¼Œåç»­çš„ç½‘é¡µå†…å®¹æŠ½å–ã€åˆ†è¯ã€ç´¢å¼•éƒ½æ˜¯ä»¥æ­¤ä¸ºå¤„ç†å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkTransporter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥å±æ€§å’Œå…¶ä»–æ–¹æ³•...</span></span><br><span class="line">    <span class="keyword">public</span> Byte[] send(HtmlRequest htmlRequest) &#123;</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlDownloader</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> NetworkTransporter transporter;<span class="comment">//é€šè¿‡æ„é€ å‡½æ•°æˆ–IOCæ³¨å…¥</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Html <span class="title">downloadHtml</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    Byte[] rawHtml = transporter.send(<span class="keyword">new</span> HtmlRequest(url));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Html(rawHtml);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Document</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Html html;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Document</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.url = url;</span><br><span class="line">    HtmlDownloader downloader = <span class="keyword">new</span> HtmlDownloader();</span><br><span class="line">    <span class="keyword">this</span>.html = downloader.downloadHtml(url);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>é¦–å…ˆçœ‹ <code>NetworkTransporter</code> ç±»</strong></p>
<p>ä½œä¸ºä¸€ä¸ªåº•å±‚ç½‘ç»œé€šä¿¡ç±»ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒçš„åŠŸèƒ½å°½å¯èƒ½é€šç”¨ï¼Œè€Œä¸åªæ˜¯æœåŠ¡äºä¸‹è½½ <code>HTML</code>ï¼Œæ‰€æœ‰è¿™é‡Œçš„å‚æ•° <code>HtmlRequest</code> å°±é™åˆ¶äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ç›´æ¥ä¾èµ–å¤ªå…·ä½“çš„å‘é€å¯¹è±¡ <code>HtmlRequest</code>ã€‚ä»è¿™ä¸€ç‚¹ä¸Šè®²ï¼Œ<code>NetworkTransporter</code> ç±»çš„è®¾è®¡è¿èƒŒè¿ªç±³ç‰¹æ³•åˆ™ï¼Œä¾èµ–äº†ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ <code>HtmlRequest</code> ç±»ã€‚</p>
<p>æœ‰ä¸€ä¸ªå¾ˆå½¢è±¡çš„æ¯”å–»ã€‚å‡å¦‚ä½ ç°åœ¨è¦å»å•†åº—ä¹°ä¸œè¥¿ï¼Œä½ è‚¯å®šä¸ä¼šç›´æ¥æŠŠé’±åŒ…ç»™æ”¶é“¶å‘˜ï¼Œè®©æ”¶é“¶å‘˜è‡ªå·±ä»é‡Œé¢æ‹¿é’±ï¼Œè€Œæ˜¯ä½ ä»é’±åŒ…é‡ŒæŠŠé’±æ‹¿å‡ºæ¥äº¤ç»™æ”¶é“¶å‘˜ã€‚è¿™é‡Œçš„ <code>HtmlRequest</code> å¯¹è±¡å°±ç›¸å½“äºé’±åŒ…ï¼Œ<code>HtmlRequest</code> é‡Œçš„ <code>address</code> å’Œ <code>content</code> å¯¹è±¡å°±ç›¸å½“äºé’±ã€‚æˆ‘ä»¬åº”è¯¥æŠŠ <code>address</code> å’Œ <code>content</code> äº¤ç»™ <code>NetworkTransporter</code>ï¼Œè€Œéæ˜¯ç›´æ¥æŠŠ <code>HtmlRequest</code> äº¤ç»™ <code>NetworkTransporter</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkTransporter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥å±æ€§å’Œå…¶ä»–æ–¹æ³•...</span></span><br><span class="line">    <span class="keyword">public</span> Byte[] send(String address, Byte[] data) &#123;</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å†æ¥çœ‹ <code>HtmlDownloader</code> ç±»</strong></p>
<p>æ ¹æ® <code>NetworkTransporter</code> çš„ä¿®æ”¹ <code>HtmlDownloader</code> ä¹Ÿå¾—åšç›¸åº”çš„ä¿®æ”¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlDownloader</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> NetworkTransporter transporter;<span class="comment">//é€šè¿‡æ„é€ å‡½æ•°æˆ–IOCæ³¨å…¥</span></span><br><span class="line">  <span class="comment">// HtmlDownloaderè¿™é‡Œä¹Ÿè¦æœ‰ç›¸åº”çš„ä¿®æ”¹</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Html <span class="title">downloadHtml</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    HtmlRequest htmlRequest = <span class="keyword">new</span> HtmlRequest(url);</span><br><span class="line">    Byte[] rawHtml = transporter.send(</span><br><span class="line">      htmlRequest.getAddress(), htmlRequest.getContent().getBytes());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Html(rawHtml);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æœ€åæ˜¯ <code>Document</code> ç±»</strong></p>
<p>ä¸»è¦æœ‰ä¸‰ç‚¹ã€‚<br>ç¬¬ä¸€ï¼Œæ„é€ å‡½æ•°ä¸­çš„ <code>downloader.downloadHtml()</code> é€»è¾‘å¤æ‚ï¼Œè€—æ—¶é•¿ï¼Œä¸åº”è¯¥æ”¾åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§<br>ç¬¬äºŒï¼Œ<code>HtmlDownloader</code> å¯¹è±¡åœ¨æ„é€ å‡½æ•°ä¸­é€šè¿‡ <code>new</code> æ¥åˆ›å»ºï¼Œè¿åäº†åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹çš„è®¾è®¡æ€æƒ³ï¼Œä¹Ÿä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§<br>ç¬¬ä¸‰ï¼Œä»ä¸šåŠ¡å«ä¹‰ä¸Šæ¥è®²ï¼Œ<code>Document</code> ç½‘é¡µæ–‡æ¡£æ²¡å¿…è¦ä¾èµ– HtmlDownloader ç±»ï¼Œè¿èƒŒäº†è¿ªç±³ç‰¹æ³•åˆ™ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Document</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Html html;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Document</span><span class="params">(String url, Html html)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.html = html;</span><br><span class="line">    <span class="keyword">this</span>.url = url;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ›å»ºDocument</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocumentFactory</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> HtmlDownloader downloader;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DocumentFactory</span><span class="params">(HtmlDownloader downloader)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.downloader = downloader;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Document <span class="title">createDocument</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    Html html = downloader.downloadHtml(url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Document(url, html);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¾ˆå¥½çš„è§£å†³äº†ä¸‰ä¸ªé—®é¢˜ã€‚</p>
</li>
</ul>
<h2 id="3-æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£"><a href="#3-æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£" class="headerlink" title="3 æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£"></a>3 æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£</h2><p>ä¸¾ä¸ªä¹‹å‰çš„æ —å­ğŸŒ°  <code>Serialization</code> ç±»è´Ÿè´£å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialization</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">serialize</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">    String serializedResult = ...;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> serializedResult;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">deserialize</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    Object deserializedResult = ...;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> deserializedResult;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•çœ‹è¿™ä¸ªç±»çš„è®¾è®¡ï¼Œæ²¡æœ‰ä¸€ç‚¹é—®é¢˜ã€‚<br>å‡è®¾åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæœ‰äº›ç±»åªç”¨åˆ°äº†åºåˆ—åŒ–æ“ä½œï¼Œè€Œå¦ä¸€äº›ç±»åªç”¨åˆ°ååºåˆ—åŒ–æ“ä½œã€‚é‚£åŸºäºè¿ªç±³ç‰¹æ³•åˆ™ååŠéƒ¨åˆ† â€œæœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£â€ ï¼Œåªç”¨åˆ°åºåˆ—åŒ–æ“ä½œçš„é‚£éƒ¨åˆ†ç±»ä¸åº”è¯¥ä¾èµ–ååºåˆ—åŒ–æ¥å£ã€‚åŒç†ï¼Œåªç”¨åˆ°ååºåˆ—åŒ–æ“ä½œçš„é‚£éƒ¨åˆ†ç±»ä¸åº”è¯¥ä¾èµ–åºåˆ—åŒ–æ¥å£ã€‚<br>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯åˆå¾—æŠŠè¿™ä¸ªç±»æ‹†å¼€æˆä¸¤ä¸ªç±»ï¼Ÿé‚£ä¸å°±å’Œä¹‹å‰åœ¨å•ä¸€èŒè´£ä¸­è¯´çš„å†²çªäº†å—ï¼Ÿä¹‹å‰æˆ‘ä»¬å°±è¯´æ‹†åˆ†åä»£ç çš„å†…èšæ€§æ˜¾ç„¶æ²¡æœ‰åŸæ¥ <code>Serialization</code> é«˜äº†ã€‚é‚£æœ‰æ²¡æœ‰æ—¢ä¸è¿èƒŒé«˜å†…èšçš„è®¾è®¡æ€æƒ³ï¼Œä¹Ÿä¸è¿èƒŒè¿ªç±³ç‰¹æ³•åˆ™çš„æ–¹æ³•å‘¢ï¼ŸğŸ¤”ğŸ¤”<br>æ—¢ç„¶åœ¨è¿™è¯´äº†ï¼Œè‚¯å®šæ˜¯æœ‰çš„ğŸ˜<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ â€œæ¥å£éš”ç¦»åŸåˆ™â€ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="function">String <span class="title">serialize</span><span class="params">(Object object)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Deserializable</span> </span>&#123;</span><br><span class="line">  <span class="function">Object <span class="title">deserialize</span><span class="params">(String text)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialization</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Deserializable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">serialize</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">    String serializedResult = ...;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> serializedResult;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">deserialize</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    Object deserializedResult = ...;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> deserializedResult;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoClass_1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Serializable serializer;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Demo</span><span class="params">(Serializable serializer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.serializer = serializer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoClass_2</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Deserializable deserializer;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Demo</span><span class="params">(Deserializable deserializer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.deserializer = deserializer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°½ç®¡æˆ‘ä»¬è¿˜æ˜¯è¦å¾€ <code>DemoClass_1</code> çš„æ„é€ å‡½æ•°ä¸­ï¼Œä¼ å…¥åŒ…å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ <code>Serialization</code> å®ç°ç±»ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¾èµ–çš„ <code>Serializable</code> æ¥å£åªåŒ…å«åºåˆ—åŒ–æ“ä½œï¼Œ<code>DemoClass_1</code> æ— æ³•ä½¿ç”¨ <code>Serialization</code> ç±»ä¸­çš„ååºåˆ—åŒ–æ¥å£ï¼Œå¯¹ååºåˆ—åŒ–æ“ä½œæ— æ„ŸçŸ¥ï¼Œè¿™ä¹Ÿå°±ç¬¦åˆäº†è¿ªç±³ç‰¹æ³•åˆ™ååŠéƒ¨åˆ†æ‰€è¯´çš„ â€œä¾èµ–æœ‰é™æ¥å£â€çš„è¦æ±‚ ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç å®ç°æ€è·¯ï¼Œä¹Ÿä½“ç°äº† â€œåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€ çš„è®¾è®¡åŸåˆ™ï¼Œç»“åˆè¿ªç±³ç‰¹æ³•åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä¸€æ¡æ–°çš„è®¾è®¡åŸåˆ™ï¼Œé‚£å°±æ˜¯ â€œåŸºäºæœ€å°æ¥å£è€Œéæœ€å¤§å®ç°ç¼–ç¨‹â€ã€‚</p>
<p>æ–°çš„è®¾è®¡æ¨¡å¼å’Œè®¾è®¡åŸåˆ™æ˜¯æ€ä¹ˆåˆ›é€ å‡ºæ¥çš„ï¼Œå®é™…ä¸Šï¼Œå°±æ˜¯åœ¨å¤§é‡çš„å®è·µä¸­ï¼Œé’ˆå¯¹å¼€å‘ç—›ç‚¹æ€»ç»“å½’çº³å‡ºæ¥çš„å¥—è·¯ã€‚</p>
<h1 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h1><blockquote>
<p><a href="https://time.geekbang.org/column/intro/250?utm_source=pinpaizhuanqu&utm_medium=geektime&utm_campaign=guanwang&utm_term=guanwang&utm_content=0511" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ä¹‹ç¾</a></p>
<p><a href="https://juejin.im/post/5d669bfc6fb9a06b1b19d25e" target="_blank" rel="noopener">é€šè¿‡ä»£ç ç¤ºä¾‹æ¥å­¦ä¹ é¢å‘å¯¹è±¡å…­å¤§åŸåˆ™</a></p>
<p><a href="https://blog.cleancoder.com/" target="_blank" rel="noopener">The Clean Code Blog</a></p>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">CalmCenter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://calmcenter.club/2020/design-philosophy.html">https://calmcenter.club/2020/design-philosophy.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://calmcenter.club" target="_blank">CalmCenter</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A0%81/">ç¼–ç </a></div><div class="post_share"></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="å¾®ä¿¡"/><div class="post-qr-code__desc">å¾®ä¿¡</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.png" alt="æ”¯ä»˜å¯¶"/><div class="post-qr-code__desc">æ”¯ä»˜å¯¶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/design-mode.html"><img class="prev_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover42.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">è®¾è®¡æ¨¡å¼ç¯‡</div></div></a></div><div class="next-post pull_right"><a href="/2020/stability-optimization.html"><img class="next_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover26.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ç¨³å®šæ€§ä¼˜åŒ–</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/design-pattern-proxy.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ä»£ç†æ¨¡å¼"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover40.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-13</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ä»£ç†æ¨¡å¼</div></div></a></div><div class="relatedPosts_item"><a href="/2020/design-mode.html" title="è®¾è®¡æ¨¡å¼ç¯‡"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover42.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-11</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼ç¯‡</div></div></a></div><div class="relatedPosts_item"><a href="/2020/design-pattern-decorator.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-è£…é¥°æ¨¡å¼"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover53.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-29</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-è£…é¥°æ¨¡å¼</div></div></a></div><div class="relatedPosts_item"><a href="/2020/oop.html" title="è®¾è®¡æ¨¡å¼ç¯‡-é¢å‘å¯¹è±¡"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover23.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-06-11</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼ç¯‡-é¢å‘å¯¹è±¡</div></div></a></div><div class="relatedPosts_item"><a href="/2020/design-pattern-composite.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ç»„åˆæ¨¡å¼"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover51.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-09-18</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ç»„åˆæ¨¡å¼</div></div></a></div><div class="relatedPosts_item"><a href="/2020/design-pattern-bridge.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-æ¡¥æ¥æ¨¡å¼"><img class="relatedPosts_cover" data-src="https://gitee.com/CalmCenter/Pic/raw/master/cover15.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-15</div><div class="relatedPosts_title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-æ¡¥æ¥æ¨¡å¼</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> è¯„è®º</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'KiQHU70TUHYrumpFuuhC3UEg-gzGzoHsz',
  appKey: 'wX1m2ATu8q4CyeRhOQ3FUucn',
  notify: true,
  verify: true,
  placeholder: 'ğŸ’¦ğŸ’¦æ—¢ç„¶æ¥äº†ä½•ä¸ç•™ä¸‹ä½ çš„è¶³è¿¹(æ”¯æŒ Markdown å“¦~)',
  avatar: 'robohash',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://gitee.com/CalmCenter/Pic/raw/master/cover38.webp)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By CalmCenter</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div><div id="landlord"><div class="message" style="opacity:0"></div><canvas class="live2d" id="live2d" width="240" height="250"></canvas><div class="hide-button">éšè—</div></div><script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script><script type="text/javascript">var message_Path = '/live2d/'
var home_Path = 'https://calmcenter.club/'</script><script type="text/javascript" src="/live2d/js/live2d.js"></script><script type="text/javascript" src="/live2d/js/message.js"></script><script type="text/javascript">loadlive2d("live2d", "/live2d/model/xxb2/model.json");</script><link rel="stylesheet" href="/live2d/css/live2d.css"/></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>ç”±</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>æä¾›æ”¯æŒ</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/search/local-search.js"></script></body></html>