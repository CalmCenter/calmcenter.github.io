<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹-å•ä¾‹æ¨¡å¼ | CalmCenter</title><meta name="keywords" content="ç¼–ç "><meta name="author" content="CalmCenter"><meta name="copyright" content="CalmCenter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="å•ä¾‹æ¨¡å¼æ˜¯åº”ç”¨æœ€å¹¿çš„æ¨¡å¼ä¹‹ä¸€ï¼Œä¹Ÿå¯èƒ½æ˜¯å¾ˆå¤šåˆçº§å·¥ç¨‹å¸ˆå”¯ä¸€ä¼šä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚ä½†æ˜¯å®ƒä¹Ÿæœ‰é«˜çº§ç”¨æ³•â›…â›…">
<meta property="og:type" content="article">
<meta property="og:title" content="è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹-å•ä¾‹æ¨¡å¼">
<meta property="og:url" content="https://calmcenter.club/2020/design-pattern-singleton.html">
<meta property="og:site_name" content="CalmCenter">
<meta property="og:description" content="å•ä¾‹æ¨¡å¼æ˜¯åº”ç”¨æœ€å¹¿çš„æ¨¡å¼ä¹‹ä¸€ï¼Œä¹Ÿå¯èƒ½æ˜¯å¾ˆå¤šåˆçº§å·¥ç¨‹å¸ˆå”¯ä¸€ä¼šä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚ä½†æ˜¯å®ƒä¹Ÿæœ‰é«˜çº§ç”¨æ³•â›…â›…">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/CalmCenter/Pic/raw/master/cover26.webp">
<meta property="article:published_time" content="2020-06-29T04:59:00.000Z">
<meta property="article:modified_time" content="2020-06-29T04:59:00.000Z">
<meta property="article:author" content="CalmCenter">
<meta property="article:tag" content="ç¼–ç ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/CalmCenter/Pic/raw/master/cover26.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://calmcenter.club/2020/design-pattern-singleton"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-06-29 12:59:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gitee.com/CalmCenter/Pic/raw/master/cover26.webp)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">CalmCenter</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹-å•ä¾‹æ¨¡å¼</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-06-29T04:59:00.000Z" title="å‘è¡¨äº 2020-06-29 12:59:00">2020-06-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2020-06-29T04:59:00.000Z" title="æ›´æ–°äº 2020-06-29 12:59:00">2020-06-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A0%81/">ç¼–ç </a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>14åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ" class="headerlink" title="1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ"></a>1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ</h1><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å•ä¾‹è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿå®ƒèƒ½è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</p>
<ul>
<li>å¤„ç†èµ„æºè®¿é—®å†²çª</li>
</ul>
<p>æ¯”å¦‚æ–‡ä»¶è®¿é—®ã€æ•°æ®åº“è®¿é—®ã€‚</p>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ç»™åŒä¸€ä¸ªå…±äº«å˜é‡åŠ  <code>1</code>ï¼Œå› ä¸ºå…±äº«å˜é‡æ˜¯ç«äº‰èµ„æºï¼Œæ‰€ä»¥ï¼Œå…±äº«å˜é‡æœ€åçš„ç»“æœæœ‰å¯èƒ½å¹¶ä¸æ˜¯åŠ äº† <code>2</code>ï¼Œè€Œæ˜¯åªåŠ äº† <code>1</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨<strong>ç±»çº§åˆ«é”</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨ä¸åŒçº¿ç¨‹åˆ›å»ºä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥<strong>å¯¹è±¡é”</strong>æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¹¶å‘é˜Ÿåˆ— <code>BlockingQueue</code> ï¼Œä½†æ˜¯å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>æœ€åæ¯”è¾ƒç®€å•çš„è§£å†³æ€è·¯å°±æ˜¯ä½¿ç”¨<strong>å•ä¾‹æ¨¡å¼</strong>äº†ï¼Œ<strong>å•ä¾‹æ¨¡å¼</strong>ç›¸å¯¹äºä¹‹å‰<strong>ç±»çº§åˆ«é”</strong>çš„å¥½å¤„æ˜¯ï¼Œä¸ç”¨åˆ›å»ºé‚£ä¹ˆå¤šå¯¹è±¡ï¼Œä¸€æ–¹é¢èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¦ä¸€æ–¹é¢èŠ‚çœç³»ç»Ÿæ–‡ä»¶å¥æŸ„ï¼ˆå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œæ–‡ä»¶å¥æŸ„ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œä¸èƒ½éšä¾¿æµªè´¹ï¼‰ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ° æ–‡ä»¶æ—¥å¿—ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è‚¯å®šä¹Ÿä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜ï¼Œçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä¼šè¦†ç›–å‰ä¸€æ¬¡çš„å†™å…¥ã€‚ä½†æ˜¯å•ä¾‹å°±æ²¡é—®é¢˜äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> FileWriter writer;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger instance = <span class="keyword">new</span> Logger();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/wangzheng/log.txt&quot;</span>);</span><br><span class="line">    writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>); <span class="comment">//trueè¡¨ç¤ºè¿½åŠ å†™å…¥</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    writer.write(mesasge);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    Logger.getInstance().log(username + <span class="string">&quot; logined!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(OrderVo order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...</span></span><br><span class="line">    Logger.getInstance().log(<span class="string">&quot;Created a order: &quot;</span> + order.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»</li>
</ul>
<p>ä»ä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œå¦‚æœæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”ä¿å­˜ä¸€ä»½ï¼Œé‚£å°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œå”¯ä¸€é€’å¢ <code>ID</code> å·ç ç”Ÿæˆå™¨ï¼Œå¦‚æœç¨‹åºä¸­æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£å°±ä¼šå­˜åœ¨ç”Ÿæˆé‡å¤ ID çš„æƒ…å†µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  <span class="comment">// AtomicLongæ˜¯ä¸€ä¸ªJavaå¹¶å‘åº“ä¸­æä¾›çš„ä¸€ä¸ªåŸå­å˜é‡ç±»å‹,</span></span><br><span class="line">  <span class="comment">// å®ƒå°†ä¸€äº›çº¿ç¨‹ä¸å®‰å…¨éœ€è¦åŠ é”çš„å¤åˆæ“ä½œå°è£…ä¸ºäº†çº¿ç¨‹å®‰å…¨çš„åŸå­æ“ä½œï¼Œ</span></span><br><span class="line">  <span class="comment">// æ¯”å¦‚ä¸‹é¢ä¼šç”¨åˆ°çš„incrementAndGet().</span></span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IdGeneratorä½¿ç”¨ä¸¾ä¾‹</span></span><br><span class="line"><span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br></pre></td></tr></table></figure>

<h1 id="2-å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ"><a href="#2-å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ" class="headerlink" title="2 å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ"></a>2 å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ</h1><h2 id="2-1-é¥¿æ±‰å¼"><a href="#2-1-é¥¿æ±‰å¼" class="headerlink" title="2.1 é¥¿æ±‰å¼"></a>2.1 é¥¿æ±‰å¼</h2><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œ<code>instance</code> é™æ€å®ä¾‹å°±å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œ<code>instance</code> å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®ç°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆä¸æ˜¯åœ¨çœŸæ­£ç”¨åˆ° <code>IdGenerator</code> çš„æ—¶å€™åˆ›å»ºå®ä¾‹ï¼‰ï¼Œä»åå­—ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œå¯¼è‡´å®ä¾‹å ç”¨èµ„æºå¤šï¼ˆæ¯”å¦‚å ç”¨å†…å­˜å¤šï¼‰æˆ–åˆå§‹åŒ–è€—æ—¶é•¿ï¼ˆæ¯”å¦‚éœ€è¦åŠ è½½å„ç§é…ç½®æ–‡ä»¶ï¼‰ï¼Œæå‰åˆå§‹åŒ–å®ä¾‹æ˜¯ä¸€ç§æµªè´¹èµ„æºçš„è¡Œä¸ºã€‚æœ€å¥½çš„æ–¹æ³•åº”è¯¥åœ¨ç”¨åˆ°çš„æ—¶å€™å†å»åˆå§‹åŒ–ã€‚æœ‰äº›éœ€è¦æå‰åˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥è¿™æ ·ç”¨ï¼Œåœ¨çœŸæ­£ä½¿ç”¨çš„æ—¶å€™èŠ‚çœäº†æ—¶é—´ã€‚</p>
<h2 id="2-2-æ‡’æ±‰å¼"><a href="#2-2-æ‡’æ±‰å¼" class="headerlink" title="2.2 æ‡’æ±‰å¼"></a>2.2 æ‡’æ±‰å¼</h2><p>æœ‰é¥¿æ±‰å¼ï¼Œå¯¹åº”çš„ï¼Œå°±æœ‰æ‡’æ±‰å¼ã€‚æ‡’æ±‰å¼ç›¸å¯¹äºé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡æ‡’æ±‰å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ç»™ <code>getInstance()</code> è¿™ä¸ªæ–¹æ³•åŠ äº†ä¸€æŠŠå¤§é”ï¼ˆ<code>synchronzed</code>ï¼‰ï¼Œå¯¼è‡´è¿™ä¸ªå‡½æ•°çš„å¹¶å‘åº¦å¾ˆä½ã€‚<br>å¦‚æœè¿™ä¸ªå•ä¾‹ç±»å¶å°”ä¼šè¢«ç”¨åˆ°ï¼Œé‚£è¿™ç§å®ç°æ–¹å¼è¿˜å¯ä»¥æ¥å—ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°ç”¨åˆ°ï¼Œé‚£é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”åŠå¹¶å‘åº¦ä½ç­‰é—®é¢˜ï¼Œä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œè¿™ç§å®ç°æ–¹å¼å°±ä¸å¯å–äº†ã€‚</p>
<h2 id="2-3-åŒé‡æ£€æµ‹"><a href="#2-3-åŒé‡æ£€æµ‹" class="headerlink" title="2.3 åŒé‡æ£€æµ‹"></a>2.3 åŒé‡æ£€æµ‹</h2><p>é¥¿æ±‰å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œæ‡’æ±‰å¼æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸æ”¯æŒé«˜å¹¶å‘ã€‚é‚£æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ã€åˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®ç°æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åŒé‡æ£€æµ‹å®ç°æ–¹å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> IdGenerator instance;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span>(IdGenerator.class) &#123; <span class="comment">// æ­¤å¤„ä¸ºç±»çº§åˆ«çš„é”</span></span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">          instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§å®ç°æ–¹å¼ä¸­ï¼Œåªè¦ <code>instance</code> è¢«åˆ›å»ºä¹‹åï¼Œå³ä¾¿å†è°ƒç”¨ <code>getInstance()</code> å‡½æ•°ä¹Ÿä¸ä¼šå†è¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­äº†ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä½ç‰ˆæœ¬ <code>Java</code> ä¸­ï¼Œå› ä¸ºæŒ‡ä»¤é‡æ’åºï¼Œå¯èƒ½ä¼šå¯¼è‡´ <code>IdGenerator</code> å¯¹è±¡è¢« <code>new</code> å‡ºæ¥ï¼Œå¹¶ä¸”èµ‹å€¼ç»™ <code>instance</code> ä¹‹åï¼Œè¿˜æ²¡æ¥å¾—åŠåˆå§‹åŒ–ï¼ˆæ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç é€»è¾‘ï¼‰ï¼Œå°±è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨äº†ã€‚<br>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç»™ <code>instance</code> æˆå‘˜å˜é‡åŠ ä¸Š <code>volatile</code> å…³é”®å­—ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºæ‰è¡Œã€‚</p>
<h2 id="2-4-é™æ€å†…éƒ¨ç±»"><a href="#2-4-é™æ€å†…éƒ¨ç±»" class="headerlink" title="2.4 é™æ€å†…éƒ¨ç±»"></a>2.4 é™æ€å†…éƒ¨ç±»</h2><p>é™æ€å†…éƒ¨ç±»æ¯”åŒé‡æ£€æµ‹æ›´åŠ ç®€å•ï¼Œåˆ©ç”¨ <code>Java</code> é™æ€å†…éƒ¨ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IdGenerator instance = <span class="keyword">new</span> IdGenerator();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªæœ‰å½“è°ƒç”¨ <code>getInstance()</code> æ–¹æ³•æ—¶ï¼Œ<code>SingletonHolder</code> æ‰ä¼šè¢«åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™æ‰ä¼šåˆ›å»º <code>instance</code>ã€‚<code>instance</code> çš„å”¯ä¸€æ€§ã€åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œéƒ½ç”± <code>JVM</code> æ¥ä¿è¯ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹æ³•æ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆèƒ½åšåˆ°å»¶è¿ŸåŠ è½½ã€‚</p>
<h2 id="2-5-æšä¸¾"><a href="#2-5-æšä¸¾" class="headerlink" title="2.5 æšä¸¾"></a>2.5 æšä¸¾</h2><p>è¿˜æœ‰ä¸€ç§æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼ŒåŸºäºæšä¸¾ç±»å‹çš„å•ä¾‹å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å®ç°æ–¹å¼é€šè¿‡ <code>Java</code> æšä¸¾ç±»å‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®ä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚</p>
<h1 id="3-å¦‚ä½•å®ç°çº¿ç¨‹å”¯ä¸€çš„å•ä¾‹ï¼Ÿ"><a href="#3-å¦‚ä½•å®ç°çº¿ç¨‹å”¯ä¸€çš„å•ä¾‹ï¼Ÿ" class="headerlink" title="3 å¦‚ä½•å®ç°çº¿ç¨‹å”¯ä¸€çš„å•ä¾‹ï¼Ÿ"></a>3 å¦‚ä½•å®ç°çº¿ç¨‹å”¯ä¸€çš„å•ä¾‹ï¼Ÿ</h1><p>å®šä¹‰ä¸­æåˆ°ï¼Œ â€œä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºå”¯ä¸€ä¸€ä¸ªå¯¹è±¡â€ ã€‚é‚£å¯¹è±¡çš„å”¯ä¸€æ€§çš„ä½œç”¨èŒƒå›´æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æŒ‡çº¿ç¨‹å†…åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯æŒ‡è¿›ç¨‹å†…åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Ÿç­”æ¡ˆæ˜¯åè€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå•ä¾‹æ¨¡å¼åˆ›å»ºçš„å¯¹è±¡æ˜¯è¿›ç¨‹å”¯ä¸€çš„ã€‚</p>
<p>é‚£å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹å”¯ä¸€çš„å•ä¾‹å‘¢ï¼Ÿ</p>
<p>åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª <code>HashMap</code> æ¥å­˜å‚¨å¯¹è±¡ï¼Œå…¶ä¸­ <code>key</code> æ˜¯çº¿ç¨‹ <code>ID</code>ï¼Œ<code>value</code> æ˜¯å¯¹è±¡ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ï¼Œä¸åŒçš„çº¿ç¨‹å¯¹åº”ä¸åŒçš„å¯¹è±¡ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åªèƒ½å¯¹åº”ä¸€ä¸ªå¯¹è±¡ã€‚å®é™…ä¸Šï¼Œ<code>Java</code> è¯­è¨€æœ¬èº«æä¾›äº† <code>ThreadLocal</code> å·¥å…·ç±»ï¼Œå¯ä»¥æ›´åŠ è½»æ¾åœ°å®ç°çº¿ç¨‹å”¯ä¸€å•ä¾‹ã€‚ä¸è¿‡ï¼Œ<code>ThreadLocal</code> åº•å±‚å®ç°åŸç†ä¹Ÿæ˜¯åŸºäºä¸‹é¢ä»£ç ä¸­æ‰€ç¤ºçš„ <code>HashMap</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGenerator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> AtomicLong id = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;Long, IdGenerator&gt; instances</span><br><span class="line">          = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">IdGenerator</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdGenerator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Long currentThreadId = Thread.currentThread().getId();</span><br><span class="line">    instances.putIfAbsent(currentThreadId, <span class="keyword">new</span> IdGenerator());</span><br><span class="line">    <span class="keyword">return</span> instances.get(currentThreadId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id.incrementAndGet();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜"><a href="#4-å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜" class="headerlink" title="4 å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜?"></a>4 å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜?</h1><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å•ä¾‹ï¼Œéƒ½æ˜¯ç”¨å®ƒæ¥è¡¨ç¤ºä¸€äº›å…¨å±€å”¯ä¸€ç±»ï¼Œæ¯”å¦‚é…ç½®ä¿¡æ¯ç±»ã€å…¬å…±ç±»ç­‰ã€‚<br>å•ä¾‹æ¨¡å¼ä¹¦å†™ç®€æ´ã€ä½¿ç”¨æ–¹ä¾¿ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œç›´æ¥é€šè¿‡ç±»ä¼¼ <code>IdGenerator.getInstance().getId()</code> è¿™æ ·çš„æ–¹æ³•æ¥è°ƒç”¨å°±å¯ä»¥äº†ã€‚<br>ä½†æ˜¯ï¼Œè¿™ç§ä½¿ç”¨æ–¹æ³•æœ‰ç‚¹ç±»ä¼¼ç¡¬ç¼–ç ï¼ˆ<code>hard code</code>ï¼‰ï¼Œä¼šå¸¦æ¥è¯¸å¤šé—®é¢˜ã€‚</p>
<h2 id="4-1-å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½"><a href="#4-1-å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½" class="headerlink" title="4.1 å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½"></a>4.1 å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½</h2><p>å•ä¾‹è¿™ç§è®¾è®¡æ¨¡å¼å¯¹äºæŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€éƒ½æ”¯æŒå¾—ä¸å¥½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœªæ¥æŸä¸€å¤©ï¼Œæˆ‘ä»¬å¸Œæœ›é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡é‡‡ç”¨ä¸åŒçš„ <code>ID</code> ç”Ÿæˆç®—æ³•ã€‚æ¯”å¦‚ï¼Œè®¢å• <code>ID</code> å’Œç”¨æˆ· <code>ID</code> é‡‡ç”¨ä¸åŒçš„ <code>ID</code> ç”Ÿæˆå™¨æ¥ç”Ÿæˆã€‚ä¸ºäº†åº”å¯¹è¿™ä¸ªéœ€æ±‚å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ‰€æœ‰ç”¨åˆ° <code>IdGenerator</code> ç±»çš„åœ°æ–¹ï¼Œè¿™æ ·ä»£ç çš„æ”¹åŠ¨å°±ä¼šæ¯”è¾ƒå¤§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br><span class="line">    <span class="comment">// éœ€è¦å°†ä¸Šé¢ä¸€è¡Œä»£ç ï¼Œæ›¿æ¢ä¸ºä¸‹é¢ä¸€è¡Œä»£ç </span></span><br><span class="line">    <span class="keyword">long</span> id = OrderIdGenerator.getIntance().getId();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">long</span> id = IdGenerator.getInstance().getId();</span><br><span class="line">    <span class="comment">// éœ€è¦å°†ä¸Šé¢ä¸€è¡Œä»£ç ï¼Œæ›¿æ¢ä¸ºä¸‹é¢ä¸€è¡Œä»£ç </span></span><br><span class="line">    <span class="keyword">long</span> id = UserIdGenerator.getIntance().getId();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½"><a href="#4-2-å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½" class="headerlink" title="4.2 å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½"></a>4.2 å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½</h2><p>å•ä¾‹æ¨¡å¼çš„ä½¿ç”¨ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ã€‚å¦‚æœå•ä¾‹ç±»ä¾èµ–æ¯”è¾ƒé‡çš„å¤–éƒ¨èµ„æºï¼Œæ¯”å¦‚ <code>DB</code>ï¼Œæˆ‘ä»¬åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¸Œæœ›èƒ½é€šè¿‡ <code>mock</code> çš„æ–¹å¼å°†å®ƒæ›¿æ¢æ‰ã€‚è€Œå•ä¾‹ç±»è¿™ç§ç¡¬ç¼–ç å¼çš„ä½¿ç”¨æ–¹å¼ï¼Œå¯¼è‡´æ— æ³•å®ç° <code>mock</code> æ›¿æ¢ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå•ä¾‹ç±»æŒæœ‰æˆå‘˜å˜é‡ï¼ˆæ¯”å¦‚ <code>IdGenerator</code> ä¸­çš„ <code>id</code> æˆå‘˜å˜é‡ï¼‰ï¼Œé‚£å®ƒå®é™…ä¸Šç›¸å½“äºä¸€ç§å…¨å±€å˜é‡ï¼Œè¢«æ‰€æœ‰çš„ä»£ç å…±äº«ã€‚å¦‚æœè¿™ä¸ªå…¨å±€å˜é‡æ˜¯ä¸€ä¸ªå¯å˜å…¨å±€å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„æˆå‘˜å˜é‡æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œé‚£æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸åŒæµ‹è¯•ç”¨ä¾‹ä¹‹é—´ï¼Œä¿®æ”¹äº†å•ä¾‹ç±»ä¸­çš„åŒä¸€ä¸ªæˆå‘˜å˜é‡çš„å€¼ï¼Œä»è€Œå¯¼è‡´æµ‹è¯•ç»“æœäº’ç›¸å½±å“çš„é—®é¢˜ã€‚</p>
<h1 id="5-å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ï¼Ÿ"><a href="#5-å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ï¼Ÿ" class="headerlink" title="5 å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ï¼Ÿ"></a>5 å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ï¼Ÿ</h1><p>è·Ÿå•ä¾‹æ¨¡å¼æ¦‚å¿µç›¸å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ã€‚é‚£å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼å‘¢ï¼Ÿ</p>
<p>â€œå•ä¾‹â€ æŒ‡çš„æ˜¯ï¼Œä¸€ä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚å¯¹åº”åœ°ï¼Œâ€œå¤šä¾‹â€ æŒ‡çš„å°±æ˜¯ï¼Œä¸€ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ¯”å¦‚åªèƒ½åˆ›å»º <code>3</code> ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BackendServer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> serverNo;</span><br><span class="line">  <span class="keyword">private</span> String serverAddress;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_COUNT = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Long, BackendServer&gt; serverInstances = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    serverInstances.put(<span class="number">1L</span>, <span class="keyword">new</span> BackendServer(<span class="number">1L</span>, <span class="string">&quot;192.134.22.138:8080&quot;</span>));</span><br><span class="line">    serverInstances.put(<span class="number">2L</span>, <span class="keyword">new</span> BackendServer(<span class="number">2L</span>, <span class="string">&quot;192.134.22.139:8080&quot;</span>));</span><br><span class="line">    serverInstances.put(<span class="number">3L</span>, <span class="keyword">new</span> BackendServer(<span class="number">3L</span>, <span class="string">&quot;192.134.22.140:8080&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">BackendServer</span><span class="params">(<span class="keyword">long</span> serverNo, String serverAddress)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.serverNo = serverNo;</span><br><span class="line">    <span class="keyword">this</span>.serverAddress = serverAddress;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BackendServer <span class="title">getInstance</span><span class="params">(<span class="keyword">long</span> serverNo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverInstances.get(serverNo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BackendServer <span class="title">getRandomInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Random r = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">int</span> no = r.nextInt(SERVER_COUNT)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> serverInstances.get(no);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§ç†è§£æ–¹å¼ï¼šåŒä¸€ç±»å‹çš„åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸åŒç±»å‹çš„å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚è¿™é‡Œçš„ â€œç±»å‹â€ å¦‚ä½•ç†è§£å‘¢ï¼Ÿ</p>
<p>åœ¨ä»£ç ä¸­ï¼Œ<code>logger name</code> å°±æ˜¯åˆšåˆšè¯´çš„ â€œç±»å‹â€ ï¼ŒåŒä¸€ä¸ª <code>logger name</code> è·å–åˆ°çš„å¯¹è±¡å®ä¾‹æ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„ <code>logger name</code> è·å–åˆ°çš„å¯¹è±¡å®ä¾‹æ˜¯ä¸åŒçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Logger&gt; instances</span><br><span class="line">          = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Logger</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getInstance</span><span class="params">(String loggerName)</span> </span>&#123;</span><br><span class="line">    instances.putIfAbsent(loggerName, <span class="keyword">new</span> Logger());</span><br><span class="line">    <span class="keyword">return</span> instances.get(loggerName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//l1==l2, l1!=l3</span></span><br><span class="line">Logger l1 = Logger.getInstance(<span class="string">&quot;User.class&quot;</span>);</span><br><span class="line">Logger l2 = Logger.getInstance(<span class="string">&quot;User.class&quot;</span>);</span><br><span class="line">Logger l3 = Logger.getInstance(<span class="string">&quot;Order.class&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å¤šä¾‹æ¨¡å¼çš„ç†è§£æ–¹å¼æœ‰ç‚¹ç±»ä¼¼å·¥å‚æ¨¡å¼ã€‚<br>å®ƒè·Ÿå·¥å‚æ¨¡å¼çš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œå¤šä¾‹æ¨¡å¼åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œå·¥å‚æ¨¡å¼åˆ›å»ºçš„æ˜¯ä¸åŒå­ç±»çš„å¯¹è±¡</p>
<p>åœ¨ä¸Šé¢çš„é—®é¢˜ä¸­å¦‚æœ <code>IdGenerator</code> åˆ†ä¸º <code>OrderIdGenerator</code> å’Œ <code>UserIdGenerator</code> ï¼Œæœ‰ä»€ä¹ˆåŠæ³•è§£å†³å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IIdGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Orderå®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderIdGenerator</span> <span class="keyword">implements</span> <span class="title">IIdGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Userå®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserIdGenerator</span> <span class="keyword">implements</span> <span class="title">IIdGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤šä¾‹æ“ä½œç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdGeneratorPresenter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Long, IIdGenerator&gt; imgInstances = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long ORDER = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long USER = <span class="number">2L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        imgInstances.put(ORDER, <span class="keyword">new</span> OrderIdGenerator());</span><br><span class="line">        imgInstances.put(USER, <span class="keyword">new</span> UserIdGenerator());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IIdGenerator <span class="title">getInstance</span><span class="params">(Long type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imgInstances.get(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line">IdGeneratorPresenter.getInstance(IdGeneratorPresenter.ORDER).getId()</span><br><span class="line">IdGeneratorPresenter.getInstance(IdGeneratorPresenter.USER).getId()</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äºç®€å•å·¥å‚å’Œå•ä¾‹çš„ç»“åˆã€‚</p>
<h1 id="6-Android-æºç ä¸­çš„å•ä¾‹æ¨¡å¼å®ç°"><a href="#6-Android-æºç ä¸­çš„å•ä¾‹æ¨¡å¼å®ç°" class="headerlink" title="6 Android æºç ä¸­çš„å•ä¾‹æ¨¡å¼å®ç°"></a>6 Android æºç ä¸­çš„å•ä¾‹æ¨¡å¼å®ç°</h1><p>æˆ‘ä»¬æ¥çœ‹çœ‹ <code>LayoutInflater</code> æ˜¯å¦‚ä½•æ‹¿åˆ°çš„ã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ <code>LayoutInflater.from(Context)</code> æ¥è·å– <code>LayoutInflater</code> æœåŠ¡, ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ <code>LayoutInflater.from(Context)</code> çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Obtains the LayoutInflater from the given context.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LayoutInflater <span class="title">from</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    LayoutInflater LayoutInflater =(LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">    <span class="keyword">if</span> (LayoutInflater == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">&quot;LayoutInflater not found.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> LayoutInflater;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° <code>from(Context)</code> å‡½æ•°å†…éƒ¨è°ƒç”¨çš„æ˜¯ <code>Context</code> ç±»çš„ <code>getSystemService(String key)</code> æ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¸ªåˆ° <code>Context</code> ç±»çœ‹åˆ°ï¼Œè¯¥ç±»æ˜¯æŠ½è±¡ç±»ã€‚<code>Context</code>çš„å®ç°ç±»ä¸º <code>ComtextImpl</code> ç±»ã€‚æˆ‘ä»¬ç»§ç»­è·Ÿè¸ªåˆ° <code>ContextImpl</code> ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getSystemService</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> SystemServiceRegistry.getSystemService(<span class="keyword">this</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ <code>SystemServiceRegistry</code> ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 : serviceå®¹å™¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashMap&lt;String, ServiceFetcher&lt;?&gt;&gt; SYSTEM_SERVICE_FETCHERS =</span><br><span class="line">          		<span class="keyword">new</span> HashMap&lt;String, ServiceFetcher&lt;?&gt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2: æ³¨å†ŒæœåŠ¡å™¨</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">registerService</span><span class="params">(String serviceName, Class&lt;T&gt; serviceClass,</span></span></span><br><span class="line"><span class="function"><span class="params">          ServiceFetcher&lt;T&gt; serviceFetcher)</span> </span>&#123;</span><br><span class="line">      SYSTEM_SERVICE_NAMES.put(serviceClass, serviceName);</span><br><span class="line">      SYSTEM_SERVICE_FETCHERS.put(serviceName, serviceFetcher);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3: é™æ€è¯­å¥å—, ç¬¬ä¸€æ¬¡åŠ è½½è¯¥ç±»æ—¶æ‰§è¡Œ ( åªæ‰§è¡Œä¸€æ¬¡, ä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§. )</span></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="comment">//  ä»£ç çœç•¥</span></span><br><span class="line">      <span class="comment">// æ³¨å†ŒActivity Servicer</span></span><br><span class="line">      registerService(Context.ACTIVITY_SERVICE, ActivityManager.class,</span><br><span class="line">              <span class="keyword">new</span> CachedServiceFetcher&lt;ActivityManager&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> ActivityManager <span class="title">createService</span><span class="params">(ContextImpl ctx)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> ActivityManager(ctx.getOuterContext(), ctx.mMainThread.getHandler());</span><br><span class="line">          &#125;&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ³¨å†ŒLayoutInflater service</span></span><br><span class="line">		registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class,</span><br><span class="line">              <span class="keyword">new</span> CachedServiceFetcher&lt;LayoutInflater&gt;() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> LayoutInflater <span class="title">createService</span><span class="params">(ContextImpl ctx)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> PhoneLayoutInflater(ctx.getOuterContext());</span><br><span class="line">        	&#125;&#125;);</span><br><span class="line">      <span class="comment">// ....ä»£ç çœç•¥</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4: æ ¹æ®keyè·å–å¯¹åº”çš„æœåŠ¡, </span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getSystemService</span><span class="params">(ContextImpl ctx, String name)</span> </span>&#123;</span><br><span class="line">      ServiceFetcher&lt;?&gt; fetcher = SYSTEM_SERVICE_FETCHERS.get(name);</span><br><span class="line">      <span class="keyword">return</span> fetcher != <span class="keyword">null</span> ? fetcher.getService(ctx) : <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ä» <code>ContextImpl</code> ç±»çš„éƒ¨åˆ†ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è™šæ‹Ÿæœºç¬¬ä¸€æ¬¡åŠ è½½è¯¥ç±»æ—¶ä¼šæ³¨å†Œå„ç§æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº† <code>LayoutInflater Service</code>ï¼Œå°†è¿™äº›æœåŠ¡ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åœ¨ä¸€ä¸ª <code>HashMap</code> ä¸­ï¼Œç”¨æˆ·ä½¿ç”¨æ—¶åªéœ€è¦æ ¹æ® <code>key</code> æ¥è·å–åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œä»è€Œè¾¾åˆ°å•ä¾‹çš„æ•ˆæœã€‚</p>
<p>æºç ä¸­å’Œæˆ‘ä¹‹å‰å†™çš„ <code>IIdGenerator</code> ç±»ä¼¼<br>ä½†æ˜¯æºç åœ¨åˆå§‹åŒ–çš„æ—¶å€™å¹¶æ²¡æœ‰çœŸæ­£çš„ <code>new PhoneLayoutInflater()</code> è€Œåœ¨ <code>getSystemService</code> çš„æ—¶å€™æ‰å»åˆ›å»ºå®ä¾‹ï¼ˆ <code>getService</code> ä¸­çš„ <code>service</code> ä¸ä¼šåˆ›å»ºç¬¬äºŒæ¬¡ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä¹‹å‰å†™çš„ä»£ç è¿˜å¯ä»¥ä¼˜åŒ–å»¶è¿ŸåŠ è½½ã€‚<br>æºç ä¸­åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°è£…äº†ä¸€å±‚å±äº<strong>å¤šå¯¹è±¡å•ä¾‹</strong>ï¼Œæˆ‘å†™çš„å±äºåˆ©ç”¨å¤šæ€å®ç°çš„<strong>å•å¯¹è±¡å¤šä¾‹</strong>ã€‚</p>
<p>ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡ä»¥å•ä¾‹å½¢å¼å­˜åœ¨ï¼Œå¹¶ä¸”å»¶è¿ŸåŠ è½½ï¼Œå‡å°‘äº†èµ„æºæ¶ˆè€—ã€‚å†æ¬¡ä¸ºæºç ç‚¹èµï¼</p>
<h1 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7 æ€»ç»“"></a>7 æ€»ç»“</h1><p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>ç”±äºå•ä¾‹æ¨¡å¼åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜å¼€æ”¯ï¼Œç‰¹åˆ«æ˜¯ä¸€ä¸ªå¯¹è±¡éœ€è¦é¢‘ç¹åœ°åˆ›å»ºã€é”€æ¯æ—¶ï¼Œè€Œä¸”åˆ›å»ºæˆ–é”€æ¯æ—¶æ€§èƒ½åˆæ— æ³•ä¼˜åŒ–ï¼Œå•ä¾‹æ¨¡å¼çš„ä¼˜åŠ¿å°±éå¸¸æ˜æ˜¾ã€‚</li>
<li>ç”±äºå•ä¾‹æ¨¡å¼åªç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥å‡å°‘äº†ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„äº§ç”Ÿéœ€è¦æ¯”è¾ƒå¤šçš„èµ„æºæ—¶ï¼Œå¦‚è¯»å–é…ç½®ã€äº§ç”Ÿå…¶ä»–ä¾èµ–å¯¹è±¡æ—¶ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨åº”ç”¨å¯åŠ¨æ—¶ç›´æ¥äº§ç”Ÿä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œç„¶åç”¨æ°¸ä¹…é©»ç•™å†…å­˜çš„æ–¹å¼æ¥è§£å†³ï¼›</li>
<li>å•ä¾‹æ¨¡å¼å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼Œä¾‹å¦‚ä¸€ä¸ªå†™æ–‡ä»¶åŠ¨ä½œï¼Œç”±äºåªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…å¯¹åŒä¸€ä¸ªèµ„æºæ–‡ä»¶çš„åŒæ—¶å†™æ“ä½œã€‚</li>
<li>å•ä¾‹æ¨¡å¼å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®å…¨å±€çš„è®¿é—®ç‚¹ï¼Œä¼˜åŒ–å’Œå…±äº«èµ„æºè®¿é—®ï¼Œä¾‹å¦‚å¯ä»¥è®¾è®¡ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè´Ÿè´£æ‰€æœ‰æ•°æ®è¡¨çš„æ˜ å°„å¤„ç†ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å¾ˆå›°éš¾ï¼Œè‹¥è¦æ‰©å±•ï¼Œé™¤äº†ä¿®æ”¹ä»£ç åŸºæœ¬ä¸Šæ²¡æœ‰ç¬¬äºŒç§é€”å¾„å¯ä»¥å®ç°ã€‚</li>
</ul>
<h1 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a><strong>æ„Ÿè°¢</strong></h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/250?utm_source=pinpaizhuanqu&utm_medium=geektime&utm_campaign=guanwang&utm_term=guanwang&utm_content=0511">è®¾è®¡æ¨¡å¼ä¹‹ç¾</a></p>
<p>ã€ŠAndroid æºç è®¾è®¡æ¨¡å¼è§£æä¸å®æˆ˜ã€‹</p>
<p>ä»¥åŠä¸Šæ–‡ä¸­çš„é“¾æ¥</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">CalmCenter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://calmcenter.club/2020/design-pattern-singleton.html">https://calmcenter.club/2020/design-pattern-singleton.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://calmcenter.club" target="_blank">CalmCenter</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A0%81/">ç¼–ç </a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/CalmCenter/Pic/raw/master/cover26.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/img/wechat.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/img/alipay.png" alt="æ”¯ä»˜å¯¶"/></a><div class="post-qr-code-desc">æ”¯ä»˜å¯¶</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/design-pattern-factory.html"><img class="prev-cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover16.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹-å·¥å‚æ¨¡å¼</div></div></a></div><div class="next-post pull-right"><a href="/2020/code-standards.html"><img class="next-cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover17.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">è®¾è®¡æ¨¡å¼-ç¼–ç è§„èŒƒç¯‡</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2020/design-pattern-template.html" title="è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover10.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-20</div><div class="title">è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹-æ¨¡æ¿æ–¹æ³•æ¨¡å¼</div></div></a></div><div><a href="/2020/design-mode.html" title="è®¾è®¡æ¨¡å¼ç¯‡"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover42.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-11</div><div class="title">è®¾è®¡æ¨¡å¼ç¯‡</div></div></a></div><div><a href="/2020/design-pattern-adapter.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-é€‚é…å™¨æ¨¡å¼"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover25.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-27</div><div class="title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-é€‚é…å™¨æ¨¡å¼</div></div></a></div><div><a href="/2020/design-pattern-composite.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ç»„åˆæ¨¡å¼"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover51.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-18</div><div class="title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-ç»„åˆæ¨¡å¼</div></div></a></div><div><a href="/2020/design-pattern-chainofresponsibility.html" title="è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹-è´£ä»»é“¾æ¨¡å¼"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover11.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-30</div><div class="title">è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹-è´£ä»»é“¾æ¨¡å¼</div></div></a></div><div><a href="/2020/design-pattern-decorator.html" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹-è£…é¥°æ¨¡å¼"><img class="cover" data-lazy-src="https://gitee.com/CalmCenter/Pic/raw/master/cover53.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-29</div><div class="title">è®¾è®¡æ¨¡å¼-ç»“æ„å‹-è£…é¥°æ¨¡å¼</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">CalmCenter</div><div class="author-info__description">ç›®æ ‡è®¾ç½®åˆ°æœˆçƒï¼Œå³ä½¿é™¨è½ä¹Ÿæ˜¯åœ¨ç¾¤æ˜Ÿä¹‹é—´ï¼</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/CalmCenter"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ä¸è¦åŠªåŠ›æˆä¸ºä¸€ä¸ªæˆåŠŸçš„äººï¼Œè€Œè¦åŠªåŠ›æˆä¸ºä¸€ä¸ªæœ‰ä»·å€¼çš„äººã€‚</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8D%95%E4%BE%8B%EF%BC%9F"><span class="toc-text">1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%8D%95%E4%BE%8B%EF%BC%9F"><span class="toc-text">2 å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E9%A5%BF%E6%B1%89%E5%BC%8F"><span class="toc-text">2.1 é¥¿æ±‰å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%87%92%E6%B1%89%E5%BC%8F"><span class="toc-text">2.2 æ‡’æ±‰å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%B5%8B"><span class="toc-text">2.3 åŒé‡æ£€æµ‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-text">2.4 é™æ€å†…éƒ¨ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%9E%9A%E4%B8%BE"><span class="toc-text">2.5 æšä¸¾</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%94%AF%E4%B8%80%E7%9A%84%E5%8D%95%E4%BE%8B%EF%BC%9F"><span class="toc-text">3 å¦‚ä½•å®ç°çº¿ç¨‹å”¯ä¸€çš„å•ä¾‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%8D%95%E4%BE%8B%E5%AD%98%E5%9C%A8%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-text">4 å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%8D%95%E4%BE%8B%E5%AF%B9%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A9%E5%B1%95%E6%80%A7%E4%B8%8D%E5%8F%8B%E5%A5%BD"><span class="toc-text">4.1 å•ä¾‹å¯¹ä»£ç çš„æ‰©å±•æ€§ä¸å‹å¥½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8D%95%E4%BE%8B%E5%AF%B9%E4%BB%A3%E7%A0%81%E7%9A%84%E5%8F%AF%E6%B5%8B%E8%AF%95%E6%80%A7%E4%B8%8D%E5%8F%8B%E5%A5%BD"><span class="toc-text">4.2 å•ä¾‹å¯¹ä»£ç çš„å¯æµ‹è¯•æ€§ä¸å‹å¥½</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%A4%9A%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-text">5 å¦‚ä½•å®ç°ä¸€ä¸ªå¤šä¾‹æ¨¡å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Android-%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">6 Android æºç ä¸­çš„å•ä¾‹æ¨¡å¼å®ç°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-text">7 æ€»ç»“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%84%9F%E8%B0%A2"><span class="toc-text">æ„Ÿè°¢</span></a></li></ol></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By CalmCenter</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '9b707b75b56f9e432b12',
      clientSecret: '6e2d5a012729aa6c9e8df3cc0a90d82f976a026e',
      repo: 'calmcenter.github.io',
      owner: 'CalmCenter',
      admin: ['CalmCenter'],
      id: 'b3d5c3d395be7a4117ac78ad85257fc8',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>